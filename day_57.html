<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 57: Parking Lot System - LLD Bootcamp</title>
    <!-- Chosen Palette: Calm Neutrals -->
    <!-- Application Structure Plan: A single-page, multi-section educational module. The structure follows a logical learning path: Theory -> Practice -> Design -> Application -> Assessment. A sticky table of contents on the right provides persistent navigation, allowing users to jump between sections easily. This linear-yet-flexible structure is ideal for a self-contained lesson, guiding the user through the material while still allowing them to revisit concepts as needed. Interactions are focused on reinforcing learning: code copying for practice, a quiz for knowledge checks, and a self-assessment challenge. -->
    <!-- Visualization & Content Choices: Report Info: UML Class Diagram -> Goal: Organize/Relationships -> Viz Method: HTML/CSS block diagram -> Interaction: None, purely visual -> Justification: Clearly represents class structure and relationships without using forbidden SVG/Mermaid. Report Info: Coding Practice -> Goal: Inform/Practice -> Presentation Method: Styled code blocks with C# syntax highlighting -> Interaction: Copy-to-clipboard button -> Justification: Facilitates easy use of code examples in the user's own IDE. Report Info: Knowledge Check -> Goal: Assess -> Presentation Method: Multiple-choice questions -> Interaction: Click to select, instant feedback -> Justification: Provides immediate reinforcement of learned concepts. Report Info: Case Study Flow -> Goal: Illustrate Change/Process -> Presentation Method: A dynamic bar chart showing parking occupancy -> Interaction: Button to simulate a day's activity, updating the chart -> Justification: Visually demonstrates the system's state changes over time, making the case study more engaging. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .font-lexend {
            font-family: 'Lexend', sans-serif;
        }
        .toc-link.active {
            color: #0ea5e9;
            border-left-color: #0ea5e9;
            font-weight: 600;
        }
        .code-block {
            position: relative;
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            overflow-x: auto;
        }
        .copy-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #334155;
            color: #cbd5e1;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-btn:hover {
            background-color: #475569;
        }
        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option:hover {
            transform: translateY(-2px);
            border-color: #38bdf8;
        }
        .correct {
            background-color: #dcfce7;
            border-color: #22c55e;
        }
        .incorrect {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        .uml-class {
            background-color: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            height: 100%;
        }
        .uml-class h3 {
            font-family: 'Lexend', sans-serif;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 0.75rem;
        }
        .uml-class .props, .uml-class .methods {
            font-family: 'monospace';
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        .uml-class .props {
            color: #475569;
        }
        .uml-class .methods {
            color: #0f769c;
        }
        .uml-relation {
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            color: #475569;
            font-style: italic;
            margin-top: 4px;
            border-top: 1px dashed #cbd5e1;
            padding-top: 4px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="bg-slate-100/80 border-b border-slate-200">
        <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 relative">
            <header class="text-center">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-800 mt-1 tracking-tight font-lexend">Low-Level Design Bootcamp</h1>
                <p class="mt-3 text-slate-600 max-w-xl mx-auto">Your 60-Day Interactive Roadmap to Mastering Backend Engineering.</p>
            </header>
            <a href="roadmap.html?week=9" class="absolute top-1/2 -translate-y-1/2 right-4 sm:right-6 lg:right-8 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">
                Return to Homepage
            </a>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="lg:grid lg:grid-cols-12 lg:gap-8">
             <main class="lg:col-span-9 space-y-16">
                <div class="text-center mb-12">
                    <p class="text-sky-600 font-semibold font-lexend">DAYS 57-60: FINAL CASE STUDY</p>
                    <h2 class="text-3xl sm:text-4xl font-extrabold text-slate-900 mt-2 font-lexend tracking-tight">Parking Lot System Design</h2>
                    <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">A deep dive into designing a scalable, concurrent, and robust parking lot management system, a classic LLD problem that tests core OOP and system design principles.</p>
                </div>

                <section id="theory" class="space-y-8">
                    <h2 class="text-3xl font-bold font-lexend text-slate-900 border-b pb-3">âœ… Theory Topics: A Comprehensive Breakdown</h2>
                    
                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">1. Requirements Engineering: The Foundation</h3>
                        <p class="mt-2 text-slate-600">This is the most critical phase. Misunderstanding requirements leads to building the wrong system. We divide them into Functional (what the system does) and Non-Functional (how the system does it).</p>
                        
                        <div class="mt-4 p-4 bg-slate-50 rounded-lg border">
                            <h4 class="font-semibold font-lexend text-slate-700">Functional Requirements</h4>
                            <p class="mt-2 text-slate-600 text-sm">These define the specific behaviors of the system.</p>
                            <ul class="mt-3 space-y-3 list-disc list-inside text-slate-700">
                                <li><strong class="font-semibold">Vehicle Entry and Exit:</strong> The system must manage vehicle entry at multiple gates. Upon entry, it should find a suitable parking spot and issue a ticket. Upon exit, it must calculate charges, process payment, and record the exit.</li>
                                <li><strong class="font-semibold">Support for Vehicle Types:</strong> The system needs to handle various vehicle types (e.g., Motorcycle, Car, Bus, Truck). Different types may require different slot sizes (e.g., a car can't park in a motorcycle spot, but it can park in a large spot if allowed).</li>
                                <li><strong class="font-semibold">Parking Slot Management:</strong> The system must keep a real-time count of vacant and occupied spots for each vehicle type.</li>
                                <li><strong class="font-semibold">Ticket Generation:</strong> A unique ticket must be generated for each entering vehicle, containing the vehicle's license plate, the assigned slot number, and the entry timestamp. This ticket is the primary identifier for a parking session.</li>
                                <li><strong class="font-semibold">Dynamic Pricing:</strong> The parking fee should be calculated based on the duration of the stay. The system should be flexible enough to support different pricing models (e.g., hourly rates, daily caps, weekend surcharges, different rates per vehicle type).</li>
                                <li><strong class="font-semibold">Payment Processing:</strong> The system must support multiple payment modes like cash, credit/debit cards, and mobile wallets at exit gates or automated kiosks.</li>
                                <li><strong class="font-semibold">Vacancy Display:</strong> Information boards at the entrance must display the number of available slots for different vehicle types in real-time.</li>
                            </ul>
                        </div>

                        <div class="mt-4 p-4 bg-slate-50 rounded-lg border">
                            <h4 class="font-semibold font-lexend text-slate-700">Non-Functional Requirements</h4>
                             <p class="mt-2 text-slate-600 text-sm">These define the quality attributes of the system.</p>
                            <ul class="mt-3 space-y-3 list-disc list-inside text-slate-700">
                                <li><strong class="font-semibold">High Availability:</strong> The system must be operational 24/7. Downtime at an entry or exit gate can cause significant traffic congestion and revenue loss.</li>
                                <li><strong class="font-semibold">Scalability:</strong> The system should be able to handle an increase in the number of parking levels, slots, or entry/exit gates without a major redesign.</li>
                                <li><strong class="font-semibold">Reliability:</strong> The system must accurately track vehicles and calculate fees. Data corruption (e.g., losing a ticket's entry time) is unacceptable.</li>
                                <li><strong class="font-semibold">Concurrency:</strong> The system must handle simultaneous requests from multiple gates gracefully, without data inconsistency. This is a core challenge.</li>
                                <li><strong class="font-semibold">Maintainability:</strong> The code should be well-structured, modular, and easy to modify or extend with new features (e.g., adding a valet parking feature).</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">2. Object-Oriented Design: Modeling the Real World</h3>
                        <p class="mt-2 text-slate-600">We use OOP to create a logical and organized structure that mirrors the real-world entities. This makes the system easier to understand, build, and maintain. Applying principles like SOLID is key.</p>
                        
                        <div class="mt-4 grid md:grid-cols-2 gap-4">
                            <div class="border border-slate-200 p-4 rounded-lg">
                                <h4 class="font-semibold font-lexend text-sky-700">The `ParkingLot` (Singleton)</h4>
                                <p class="text-sm text-slate-600 mt-1">This is the main container class, the brain of the operation. It's often implemented as a Singleton since there's only one parking lot. It holds all the floors, gates, and display boards, and orchestrates the core logic of parking and unparking vehicles.</p>
                            </div>
                             <div class="border border-slate-200 p-4 rounded-lg">
                                <h4 class="font-semibold font-lexend text-sky-700">`Vehicle` (Abstract Class)</h4>
                                <p class="text-sm text-slate-600 mt-1">Defines a template for any vehicle. It has common properties like `LicensePlate` and `VehicleType`. Specific classes like `Car`, `Motorcycle`, and `Truck` inherit from it. This is an example of Abstraction.</p>
                            </div>
                            <div class="border border-slate-200 p-4 rounded-lg">
                                <h4 class="font-semibold font-lexend text-sky-700">`Slot` (or `ParkingSpot`)</h4>
                                <p class="text-sm text-slate-600 mt-1">Represents a single parking space. It encapsulates its state: `SlotNumber`, `IsOccupied`, `SlotType`, and the `ParkedVehicle`. Its methods (`ParkVehicle`, `VacateSlot`) control its state. This is Encapsulation.</p>
                            </div>
                            <div class="border border-slate-200 p-4 rounded-lg">
                                <h4 class="font-semibold font-lexend text-sky-700">`Ticket`</h4>
                                <p class="text-sm text-slate-600 mt-1">A data object that acts as a proof of parking. It's generated at entry and contains all necessary information for the session: `TicketId`, `EntryTime`, `SlotId`, and `VehicleLicensePlate`.</p>
                            </div>
                             <div class="border border-slate-200 p-4 rounded-lg">
                                <h4 class="font-semibold font-lexend text-sky-700">`Gate` (Entry/Exit)</h4>
                                <p class="text-sm text-slate-600 mt-1">Models the physical gates. An `EntryGate` would be responsible for creating tickets, while an `ExitGate` would handle payment processing and vacating slots.</p>
                            </div>
                             <div class="border border-slate-200 p-4 rounded-lg">
                                <h4 class="font-semibold font-lexend text-sky-700">`IPricingStrategy` (Interface - Strategy Pattern)</h4>
                                <p class="text-sm text-slate-600 mt-1">To handle dynamic pricing, we use the Strategy Pattern. We define an interface with a `CalculatePrice` method. Concrete classes like `HourlyPricing`, `DailyPricing`, or `DynamicPricing` implement this interface. This allows us to change the pricing logic without altering the rest of the system.</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">3. Concurrency Control: The Core Challenge</h3>
                        <p class="mt-2 text-slate-600">Imagine two cars arriving at two different entry gates at the exact same millisecond. Both gates query the system for the last available compact slot. Without proper control, both might receive the same slot number, leading to chaos. This is a classic race condition.</p>
                        
                        <div class="mt-4 p-4 bg-sky-50 border border-sky-200 rounded-lg">
                            <h4 class="font-semibold text-sky-800">The Critical Section</h4>
                            <p class="mt-1 text-sky-700">The block of code that performs the sequence of "find a free slot -> mark it as occupied -> update the vacancy count" is the **critical section**. We must ensure that only one thread (representing one gate's request) can execute this section at any given time. This property is called **mutual exclusion**.</p>
                        </div>

                        <div class="mt-4">
                            <h4 class="font-semibold text-slate-700">Mechanisms for Concurrency Control:</h4>
                            <ul class="mt-2 space-y-3">
                                <li>
                                    <strong class="font-semibold">Locks (Mutexes):</strong> This is the most common and straightforward approach. A lock is an object that acts as a token. A thread must "acquire" the lock before entering the critical section. While one thread holds the lock, any other thread trying to acquire it will be forced to wait. Once the first thread exits the critical section, it "releases" the lock, allowing one of the waiting threads to proceed. In C#, the `lock` keyword provides a simple way to implement this.
                                </li>
                                <li>
                                    <strong class="font-semibold">Semaphores:</strong> A more advanced mechanism. While a mutex allows only one thread, a semaphore can allow a specified number of threads (N) to access a resource. This isn't ideal for our slot allocation problem (which needs N=1), but could be useful for scenarios like "allow a maximum of 10 cars to be in the process of entering the payment queue simultaneously".
                                </li>
                                 <li>
                                    <strong class="font-semibold">Database Transactions:</strong> If the state of parking slots is persisted in a database, we can leverage database transactions with appropriate isolation levels (e.g., `SERIALIZABLE`). When a gate process wants to allocate a slot, it would start a transaction, read the available slots, and update the chosen slot's status. The database guarantees that this transaction is atomic, consistent, isolated, and durable (ACID).
                                </li>
                            </ul>
<pre class="code-block mt-4"><code class="language-csharp">
// The lock object. It should be a private readonly field.
private readonly object _slotAllocationLock = new object();

public Slot AllocateSlot(Vehicle vehicle)
{
    // The 'lock' statement acquires the mutex for the _slotAllocationLock object.
    // Only one thread can enter this block at a time. Other threads will wait here.
    lock (_slotAllocationLock)
    {
        // === CRITICAL SECTION START ===
        
        // 1. Find the first available slot that fits the vehicle.
        Slot availableSlot = _slots.FirstOrDefault(s => !s.IsOccupied && CanVehicleFit(vehicle, s));
        
        // This check is now safe from race conditions.
        if (availableSlot != null)
        {
            // 2. Mark it as occupied.
            availableSlot.ParkVehicle(vehicle);
            
            // 3. Update the vacancy count (e.g., for the display board).
            UpdateDisplayBoard();
            
            return availableSlot;
        }

        // === CRITICAL SECTION END ===
    } // The lock is automatically released when the block is exited.
    
    return null; // No slot was found.
}
</code><button class="copy-btn">Copy</button></pre>
                        </div>
                    </div>

                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">4. Database Schema Design: Persisting State</h3>
                        <p class="mt-2 text-slate-600">While the application logic runs in memory, we need a database to store the state permanently. This ensures data survives application restarts and can be used for logging, analytics, and recovery. A relational model is a natural fit.</p>
                        <div class="mt-4 space-y-6">
                            <div>
                                <h4 class="font-semibold font-lexend">Key Tables and Relationships</h4>
                                <p class="text-slate-600 text-sm">The schema is designed to minimize data redundancy and maintain integrity using foreign keys.</p>
                                <ul class="mt-2 list-disc list-inside text-slate-700">
                                    <li>`ParkingSlots` has a one-to-many relationship with `Tickets` (one slot can have many tickets over time, but only one active one).</li>
                                    <li>`Vehicles` has a one-to-many relationship with `Tickets` (one vehicle can have multiple parking sessions).</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-semibold font-lexend">ParkingSlots Table</h4>
                                <p class="text-sm text-slate-500">Static information about each slot.</p>
                                <div class="overflow-x-auto mt-2">
                                    <table class="w-full text-sm text-left table-auto">
                                        <thead class="bg-slate-100 text-slate-600">
                                            <tr><th class="p-2">Column</th><th class="p-2">Type</th><th class="p-2">Constraints</th><th class="p-2">Notes</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b"><td class="p-2 font-mono">SlotId</td><td class="p-2 font-mono">INT</td><td class="p-2">PRIMARY KEY</td><td class="p-2">Unique identifier for a slot.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">FloorNumber</td><td class="p-2 font-mono">INT</td><td class="p-2"></td><td class="p-2">Location of the slot.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">SlotType</td><td class="p-2 font-mono">ENUM</td><td class="p-2"></td><td class="p-2">'Compact', 'Large', 'Motorcycle'</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">IsOccupied</td><td class="p-2 font-mono">BOOLEAN</td><td class="p-2">INDEX</td><td class="p-2">Crucial for fast lookups of free slots.</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold font-lexend">Tickets Table</h4>
                                <p class="text-sm text-slate-500">Transactional data for each parking session.</p>
                                <div class="overflow-x-auto mt-2">
                                    <table class="w-full text-sm text-left table-auto">
                                        <thead class="bg-slate-100 text-slate-600">
                                            <tr><th class="p-2">Column</th><th class="p-2">Type</th><th class="p-2">Constraints</th><th class="p-2">Notes</th></tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b"><td class="p-2 font-mono">TicketId</td><td class="p-2 font-mono">BIGINT</td><td class="p-2">PRIMARY KEY</td><td class="p-2">Unique ID for the session.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">VehicleLicensePlate</td><td class="p-2 font-mono">VARCHAR(20)</td><td class="p-2">INDEX</td><td class="p-2">For finding a vehicle's tickets.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">SlotId</td><td class="p-2 font-mono">INT</td><td class="p-2">FOREIGN KEY</td><td class="p-2">Links to the ParkingSlots table.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">EntryTime</td><td class="p-2 font-mono">DATETIME</td><td class="p-2"></td><td class="p-2">Start of the session.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">ExitTime</td><td class="p-2 font-mono">DATETIME</td><td class="p-2">NULLable</td><td class="p-2">End of the session.</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">Status</td><td class="p-2 font-mono">ENUM</td><td class="p-2"></td><td class="p-2">'ACTIVE', 'PAID', 'LOST'</td></tr>
                                            <tr class="border-b"><td class="p-2 font-mono">AmountPaid</td><td class="p-2 font-mono">DECIMAL(10, 2)</td><td class="p-2">NULLable</td><td class="p-2">Final cost.</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="coding-practice" class="space-y-8">
                    <h2 class="text-3xl font-bold font-lexend text-slate-900 border-b pb-3">âœ… Coding Practice (C#)</h2>
                    
                    <div>
                        <h3 class="text-xl font-bold font-lexend text-slate-800">Implement Vehicle & Slot Classes</h3>
                        <p class="mt-2 text-slate-600">We start by defining our core entities. An enum for types helps enforce valid values. The `Vehicle` class is abstract because you can't have a generic "vehicle"; it must be a `Car` or `Motorcycle`, etc.</p>
<pre class="code-block mt-4"><code class="language-csharp">
public enum VehicleType { Motorcycle, Car, Truck }
public enum SlotType { Motorcycle, Compact, Large }

// Abstract base class for all vehicles
public abstract class Vehicle
{
    public string LicensePlate { get; private set; }
    public VehicleType Type { get; private set; }

    protected Vehicle(string licensePlate, VehicleType type)
    {
        LicensePlate = licensePlate;
        Type = type;
    }
}

// Concrete implementation of a Vehicle
public class Car : Vehicle
{
    public Car(string licensePlate) : base(licensePlate, VehicleType.Car) { }
}

// Represents a single parking spot
public class Slot
{
    public int Id { get; private set; }
    public SlotType Type { get; private set; }
    public bool IsOccupied { get; private set; }
    public Vehicle ParkedVehicle { get; private set; }

    public Slot(int id, SlotType type)
    {
        Id = id;
        Type = type;
        IsOccupied = false;
    }

    // Assigns a vehicle to this slot
    public void ParkVehicle(Vehicle vehicle)
    {
        if (!IsOccupied) {
            ParkedVehicle = vehicle;
            IsOccupied = true;
        }
    }

    // Frees up the slot
    public void VacateSlot()
    {
        ParkedVehicle = null;
        IsOccupied = false;
    }
}
</code><button class="copy-btn">Copy</button></pre>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold font-lexend text-slate-800">[Easy] Allocate Free Slot</h3>
                        <p class="mt-2 text-slate-600">This logic resides within a main `ParkingLot` class. It iterates through its list of slots to find the first available spot that can accommodate the vehicle. Note the `CanVehicleFit` logic: a car can fit in a Compact or Large slot.</p>
<pre class="code-block mt-4"><code class="language-csharp">
public class ParkingLot
{
    private List<Slot> _slots;
    
    public ParkingLot(int motorcycleSlots, int compactSlots, int largeSlots)
    {
        _slots = new List<Slot>();
        int idCounter = 1;
        for (int i = 0; i < motorcycleSlots; i++) _slots.Add(new Slot(idCounter++, SlotType.Motorcycle));
        for (int i = 0; i < compactSlots; i++) _slots.Add(new Slot(idCounter++, SlotType.Compact));
        for (int i = 0; i < largeSlots; i++) _slots.Add(new Slot(idCounter++, SlotType.Large));
    }

    public Slot FindAvailableSlot(Vehicle vehicle)
    {
        return _slots.FirstOrDefault(slot => !slot.IsOccupied && CanVehicleFit(vehicle, slot));
    }
    
    private bool CanVehicleFit(Vehicle vehicle, Slot slot)
    {
        switch (vehicle.Type)
        {
            case VehicleType.Motorcycle:
                return true; // Can fit anywhere
            case VehicleType.Car:
                return slot.Type == SlotType.Compact || slot.Type == SlotType.Large;
            case VehicleType.Truck:
                return slot.Type == SlotType.Large;
            default:
                return false;
        }
    }
}
</code><button class="copy-btn">Copy</button></pre>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold font-lexend text-slate-800">[Medium] Ticket Generation & Pricing</h3>
                        <p class="mt-2 text-slate-600">When a vehicle enters, we generate a ticket. Upon exit, we use the ticket to calculate the fee. We'll use a simple hourly pricing strategy here.</p>
<pre class="code-block mt-4"><code class="language-csharp">
public class Ticket
{
    public int Id { get; }
    public DateTime EntryTime { get; }
    public string VehicleLicensePlate { get; }
    public int SlotId { get; }

    public Ticket(string licensePlate, int slotId)
    {
        Id = new Random().Next(1000, 9999);
        EntryTime = DateTime.Now;
        VehicleLicensePlate = licensePlate;
        SlotId = slotId;
    }
}

public class PricingService
{
    private const double HOURLY_RATE = 5.0; // $5 per hour

    public double CalculatePrice(Ticket ticket)
    {
        var duration = DateTime.Now - ticket.EntryTime;
        // Business logic: Charge for a full hour for any part of an hour.
        double hours = Math.Ceiling(duration.TotalHours);
        return hours * HOURLY_RATE;
    }
}
</code><button class="copy-btn">Copy</button></pre>
                    </div>

                    <div>
                        <h3 class="text-xl font-bold font-lexend text-slate-800">[Hard] Concurrency Simulation</h3>
                        <p class="mt-2 text-slate-600">Here's a simulation. We'll use C#'s `Task` library to simulate two cars entering at the same time, competing for one slot. The `lock` keyword is essential to ensure only one car gets the slot and the other is turned away correctly.</p>
<pre class="code-block mt-4"><code class="language-csharp">
public class ParkingLotManager
{
    private readonly ParkingLot _parkingLot;
    private readonly object _entryLock = new object();

    public ParkingLotManager(ParkingLot lot) { _parkingLot = lot; }

    public Ticket HandleVehicleEntry(Vehicle vehicle)
    {
        lock (_entryLock)
        {
            Console.WriteLine($"Thread {Thread.CurrentThread.ManagedThreadId}: Acquired lock for {vehicle.LicensePlate}");
            Console.WriteLine($"--> Finding slot for {vehicle.LicensePlate}...");
            Slot availableSlot = _parkingLot.FindAvailableSlot(vehicle);
            
            // Simulate processing time
            Thread.Sleep(50); 
            
            if (availableSlot != null)
            {
                availableSlot.ParkVehicle(vehicle);
                Console.WriteLine($"<-- SUCCESS: {vehicle.LicensePlate} parked in slot {availableSlot.Id}");
                Console.WriteLine($"Thread {Thread.CurrentThread.ManagedThreadId}: Releasing lock for {vehicle.LicensePlate}");
                return new Ticket(vehicle.LicensePlate, availableSlot.Id);
            }
            
            Console.WriteLine($"<-- FAILURE: No slot available for {vehicle.LicensePlate}");
            Console.WriteLine($"Thread {Thread.CurrentThread.ManagedThreadId}: Releasing lock for {vehicle.LicensePlate}");
            return null;
        }
    }
    
    public static async Task RunConcurrencyTest()
    {
        // A small parking lot with just ONE compact slot
        var lot = new ParkingLot(0, 1, 0);
        var manager = new ParkingLotManager(lot);

        var car1 = new Car("CAR-01");
        var car2 = new Car("CAR-02");

        Console.WriteLine("Starting concurrency test: Two cars, one slot.");
        Task<Ticket> task1 = Task.Run(() => manager.HandleVehicleEntry(car1));
        Task<Ticket> task2 = Task.Run(() => manager.HandleVehicleEntry(car2));

        await Task.WhenAll(task1, task2);
        Console.WriteLine("Concurrency test finished.");
    }
}
</code><button class="copy-btn">Copy</button></pre>
                    </div>

                </section>

                <section id="uml-diagram" class="space-y-8">
                    <h2 class="text-3xl font-bold font-lexend text-slate-900 border-b pb-3">âœ… UML/Schema Task: Expanded Class Diagram</h2>
                    <p class="text-slate-600">This diagram shows a more complete set of classes and their relationships, including the Strategy Pattern for pricing. Arrows and labels indicate relationships like composition ("has-a") and implementation.</p>
                    <div class="p-6 bg-slate-100 rounded-xl relative">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="uml-class">
                                <h3>ParkingLot</h3>
                                <div class="props">- floors: List&lt;Floor&gt;<br>- gates: List&lt;Gate&gt;</div>
                                <div class="methods mt-2">+ AllocateTicket(Vehicle)<br>+ ProcessPayment(Ticket)</div>
                                <div class="uml-relation">Composition: Has-a Floor, Has-a Gate</div>
                            </div>
                            <div class="uml-class">
                                <h3>Slot</h3>
                                <div class="props">- id: int<br>- type: SlotType<br>- isOccupied: bool</div>
                                <div class="methods mt-2">+ ParkVehicle(Vehicle)<br>+ VacateSlot()</div>
                            </div>
                            <div class="uml-class">
                                <h3>Vehicle <span class="text-xs font-light italic">(Abstract)</span></h3>
                                <div class="props">- licensePlate: string<br>- type: VehicleType</div>
                            </div>
                            <div class="uml-class">
                                <h3>Ticket</h3>
                                <div class="props">- id: int<br>- entryTime: DateTime<br>- status: TicketStatus</div>
                                <div class="uml-relation">Association: Links a Vehicle to a Slot</div>
                            </div>
                            <div class="uml-class">
                                <h3>IPricingStrategy <span class="text-xs font-light italic">(Interface)</span></h3>
                                <div class="methods mt-2">+ CalculatePrice(Ticket): double</div>
                                <div class="uml-relation">Implemented by Concrete Strategies</div>
                            </div>
                            <div class="uml-class">
                                <h3>HourlyPricing</h3>
                                <div class="methods mt-2">+ CalculatePrice(Ticket): double</div>
                                <div class="uml-relation">Implementation of IPricingStrategy</div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="case-study" class="space-y-8">
                    <h2 class="text-3xl font-bold font-lexend text-slate-900 border-b pb-3">âœ… Case Study: A Day in the Life of a Parking Lot</h2>
                    <p class="text-slate-600">Let's trace the journey of a single vehicle to see the system in action. This interactive chart simulates parking lot occupancy over a 12-hour period. Click the button to see how it changes.</p>

                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">Detailed Scenario Flow</h3>
                        <ol class="mt-4 space-y-4 list-decimal list-inside text-slate-700">
                            <li>
                                <strong class="font-semibold">8:00 AM - Vehicle Arrival at Entry Gate 1:</strong>
                                <ul class="pl-5 mt-1 space-y-1 list-disc list-inside text-slate-600">
                                    <li>A `Car` with license plate "CAR-123" arrives. The `EntryGate` object's sensor is triggered.</li>
                                    <li>The `EntryGate` calls the central `ParkingLot.AllocateTicket("CAR-123", VehicleType.Car)` method.</li>
                                    <li>The `ParkingLot` manager acquires a lock to ensure thread safety.</li>
                                    <li>It iterates through its floors and slots, calling `FindAvailableSlot(VehicleType.Car)`. It finds slot `C-05` (a `Compact` slot) is free.</li>
                                    <li>It marks `C-05` as occupied: `slot.ParkVehicle(carObject)`.</li>
                                    <li>It creates a new `Ticket` instance with the current timestamp, vehicle info, and slot `C-05`. This ticket is stored in a central repository (e.g., a Dictionary or database).</li>
                                    <li>The `ParkingLot` returns the `Ticket` to the `EntryGate`. The gate prints the ticket and opens the barrier. The `DisplayBoard` is updated.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="font-semibold">11:25 AM - Parking Duration:</strong>
                                <ul class="pl-5 mt-1 space-y-1 list-disc list-inside text-slate-600">
                                    <li>The vehicle remains parked. The state of slot `C-05` is `IsOccupied = true`. The `Ticket` status is `ACTIVE`.</li>
                                </ul>
                            </li>
                             <li>
                                <strong class="font-semibold">11:26 AM - Vehicle Exit at Exit Gate 3:</strong>
                                <ul class="pl-5 mt-1 space-y-1 list-disc list-inside text-slate-600">
                                    <li>The driver scans their ticket at an `ExitGate`. The gate reads the `TicketId`.</li>
                                    <li>The `ExitGate` calls `ParkingLot.ProcessPayment(ticketId)`.</li>
                                    <li>The `ParkingLot` retrieves the `Ticket` from its records. Entry time was 8:00 AM, current time is 11:26 AM. Duration: 3h 26m.</li>
                                    <li>It uses its configured `IPricingStrategy` (e.g., an `HourlyPricing` instance). The strategy's `CalculatePrice` method is called. It rounds up to 4 hours. Fee = 4 hours * $5/hour = $20.0.</li>
                                    <li>The `ExitGate` displays "$20.00" and prompts for payment. The `PaymentProcessor` handles the credit card transaction.</li>
                                    <li>Upon successful payment, the `ParkingLot` does two things:
                                        <ol class="list-[lower-alpha] pl-5">
                                            <li>Finds `Slot` C-05 and calls `slot.VacateSlot()`, setting `IsOccupied = false`.</li>
                                            <li>Updates the `Ticket` status to `PAID` and records the `ExitTime` and `AmountPaid`.</li>
                                        </ol>
                                    </li>
                                    <li>The `ExitGate` opens its barrier. The `DisplayBoard` is updated again to reflect one more available `Compact` slot.</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">Interactive Occupancy Simulation</h3>
                        <div class="mt-4">
                            <div class="chart-container" style="position: relative; height:40vh; width:100%; max-width: 800px; margin: auto;">
                                <canvas id="occupancyChart"></canvas>
                            </div>
                            <div class="text-center mt-4">
                                <button id="simulateDayBtn" class="bg-sky-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-sky-700 transition-colors shadow-sm">
                                    Simulate a Day
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="knowledge-check" class="space-y-6">
                    <h2 class="text-3xl font-bold font-lexend text-slate-900 border-b pb-3">âœ… Knowledge Check</h2>
                    <div id="quiz-container" class="space-y-6"></div>
                </section>

                <section id="self-assessment" class="space-y-6">
                    <h2 class="text-3xl font-bold font-lexend text-slate-900 border-b pb-3">ðŸŽ¯ Self-Assessment Challenge</h2>
                    <div class="p-6 bg-white rounded-xl shadow-sm">
                        <h3 class="text-xl font-bold font-lexend text-slate-800">Challenge: Implement a Dynamic Pricing Strategy</h3>
                        <p class="mt-2 text-slate-600">Modify the system to support a more complex pricing model. Your task is to implement a `DynamicPricingStrategy` that adheres to the following rules:</p>
                        <ul class="mt-4 list-disc list-inside text-slate-700 space-y-2">
                            <li>The first hour is a flat rate of $4.</li>
                            <li>The second and third hours are $3 per hour.</li>
                            <li>Any hour after the third is $2 per hour.</li>
                            <li>Implement this logic in a new class that implements an `IPricingStrategy` interface.</li>
                        </ul>
                        <button id="revealSolutionBtn" class="mt-6 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">
                            Reveal Solution
                        </button>
                        <div id="solutionContainer" class="hidden mt-4">
<pre class="code-block"><code class="language-csharp">
// 1. Define the Interface (The "Contract")
public interface IPricingStrategy
{
    double CalculatePrice(Ticket ticket);
}

// 2. Implement the concrete strategy
public class DynamicPricingStrategy : IPricingStrategy
{
    public double CalculatePrice(Ticket ticket)
    {
        var duration = DateTime.Now - ticket.EntryTime;
        double totalHours = Math.Ceiling(duration.TotalHours);
        double totalCost = 0;

        if (totalHours <= 0) return 0;

        // First hour costs $4
        totalCost += 4.0;
        if (totalHours == 1) return totalCost;

        // Second and third hours cost $3 each
        if (totalHours > 1) {
            totalCost += 3.0; // for the second hour
        }
        if (totalHours > 2) {
            totalCost += 3.0; // for the third hour
        }
        if (totalHours <= 3) return totalCost;
        
        // All subsequent hours cost $2 each
        double remainingHours = totalHours - 3;
        totalCost += remainingHours * 2.0;

        return totalCost;
    }
}

// 3. Use the strategy in the PaymentService
public class PaymentService
{
    private readonly IPricingStrategy _pricingStrategy;

    // The strategy is injected via the constructor (Dependency Injection)
    public PaymentService(IPricingStrategy strategy)
    {
        _pricingStrategy = strategy;
    }

    public double GetFee(Ticket ticket)
    {
        return _pricingStrategy.CalculatePrice(ticket);
    }
}

// Example of creating and using it:
var dynamicStrategy = new DynamicPricingStrategy();
var paymentService = new PaymentService(dynamicStrategy);
// double fee = paymentService.GetFee(someTicket);
</code><button class="copy-btn">Copy</button></pre>
                        </div>
                    </div>
                </section>
            </main>
            <div class="lg:col-span-3">
                <nav id="toc" class="sticky top-8 hidden lg:block">
                    <h3 class="font-lexend font-semibold text-slate-900">On this page</h3>
                    <ul class="space-y-2 mt-4 text-sm">
                        <li><a href="#theory" class="toc-link block border-l-2 border-transparent pl-4 py-1 text-slate-600 hover:text-slate-900 hover:border-slate-400">Theory Topics</a></li>
                        <li><a href="#coding-practice" class="toc-link block border-l-2 border-transparent pl-4 py-1 text-slate-600 hover:text-slate-900 hover:border-slate-400">Coding Practice</a></li>
                        <li><a href="#uml-diagram" class="toc-link block border-l-2 border-transparent pl-4 py-1 text-slate-600 hover:text-slate-900 hover:border-slate-400">UML Class Diagram</a></li>
                        <li><a href="#case-study" class="toc-link block border-l-2 border-transparent pl-4 py-1 text-slate-600 hover:text-slate-900 hover:border-slate-400">Case Study: Full System</a></li>
                        <li><a href="#knowledge-check" class="toc-link block border-l-2 border-transparent pl-4 py-1 text-slate-600 hover:text-slate-900 hover:border-slate-400">Knowledge Check</a></li>
                        <li><a href="#self-assessment" class="toc-link block border-l-2 border-transparent pl-4 py-1 text-slate-600 hover:text-slate-900 hover:border-slate-400">Self-Assessment Challenge</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    
    <footer class="text-center mt-16 py-8 border-t border-slate-200">
        <p class="text-slate-700 font-semibold">Low-Level Design Bootcamp</p>
        <p class="text-sm text-slate-500 mt-2">A personalized learning roadmap curated by Mr. Mahesh Singare.</p>
        <p class="text-xs text-slate-400 mt-4">&copy; 2025. All Rights Reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Table of Contents Scrollspy
            const sections = document.querySelectorAll('main section[id]');
            const tocLinks = document.querySelectorAll('#toc .toc-link');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const id = entry.target.getAttribute('id');
                    const tocLink = document.querySelector(`#toc .toc-link[href="#${id}"]`);
                    if (entry.isIntersecting && entry.intersectionRatio > 0.2) {
                        tocLinks.forEach(link => link.classList.remove('active'));
                        if(tocLink) tocLink.classList.add('active');
                    }
                });
            }, { rootMargin: '-20% 0px -70% 0px', threshold: 0.1 });

            sections.forEach(section => {
                observer.observe(section);
            });
            
            // Copy to Clipboard
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const code = button.previousElementSibling.textContent;
                    navigator.clipboard.writeText(code).then(() => {
                        button.textContent = 'Copied!';
                        setTimeout(() => {
                            button.textContent = 'Copy';
                        }, 2000);
                    });
                });
            });

            // Reveal Solution
            const revealBtn = document.getElementById('revealSolutionBtn');
            const solutionContainer = document.getElementById('solutionContainer');
            if (revealBtn) {
                revealBtn.addEventListener('click', () => {
                    solutionContainer.classList.toggle('hidden');
                    revealBtn.textContent = solutionContainer.classList.contains('hidden') ? 'Reveal Solution' : 'Hide Solution';
                });
            }

            // Quiz Logic
            const quizData = [
                {
                    question: "What is the primary reason for using a 'lock' when allocating a parking slot?",
                    options: ["To speed up the allocation process", "To ensure only one vehicle can enter the parking lot at a time", "To prevent race conditions where two vehicles might be assigned the same slot", "To encrypt the ticket information"],
                    answer: "To prevent race conditions where two vehicles might be assigned the same slot"
                },
                {
                    question: "In an OOP design for a parking lot, which class is most suitable for being 'abstract'?",
                    options: ["Ticket", "Slot", "Vehicle", "ParkingLot"],
                    answer: "Vehicle"
                },
                {
                    question: "Using the Strategy Pattern for pricing (IPricingStrategy) primarily improves which non-functional requirement?",
                    options: ["Scalability", "Availability", "Reliability", "Maintainability"],
                    answer: "Maintainability"
                },
                {
                    question: "A car arrives but only motorcycle slots are free. According to the provided logic, what should happen?",
                    options: ["The car is parked in a motorcycle slot.", "The car is turned away as no suitable slot is free.", "The system waits for a compact slot to become free.", "The system splits a large slot into two."],
                    answer: "The car is turned away as no suitable slot is free."
                }
            ];
            
            const quizContainer = document.getElementById('quiz-container');

            function renderQuiz() {
                quizData.forEach((q, index) => {
                    const questionEl = document.createElement('div');
                    questionEl.className = 'p-6 bg-white rounded-xl shadow-sm';
                    
                    let optionsHtml = '';
                    q.options.forEach(option => {
                        optionsHtml += `<button data-question="${index}" data-answer="${option}" class="quiz-option w-full text-left p-4 mt-2 border-2 border-slate-200 rounded-lg hover:border-sky-400 focus:outline-none focus:ring-2 focus:ring-sky-300">${option}</button>`;
                    });

                    questionEl.innerHTML = `
                        <h3 class="text-lg font-semibold text-slate-800">${index + 1}. ${q.question}</h3>
                        <div class="mt-4 space-y-2">${optionsHtml}</div>
                        <p class="feedback mt-3 text-sm font-semibold"></p>
                    `;
                    quizContainer.appendChild(questionEl);
                });
            }

            quizContainer.addEventListener('click', function(e) {
                if(e.target.classList.contains('quiz-option')) {
                    const qIndex = e.target.dataset.question;
                    const selectedAnswer = e.target.dataset.answer;
                    const questionData = quizData[qIndex];
                    const questionEl = e.target.closest('.p-6');
                    const feedbackEl = questionEl.querySelector('.feedback');
                    const allOptions = questionEl.querySelectorAll('.quiz-option');

                    allOptions.forEach(opt => {
                        opt.disabled = true;
                        opt.classList.remove('hover:border-sky-400');
                        const isCorrect = questionData.answer === opt.dataset.answer;
                        if(isCorrect) {
                            opt.classList.add('correct');
                        }
                    });

                    if (selectedAnswer === questionData.answer) {
                        e.target.classList.add('correct');
                        feedbackEl.textContent = 'Correct!';
                        feedbackEl.className = 'feedback mt-3 text-sm font-semibold text-green-600';
                    } else {
                        e.target.classList.add('incorrect');
                        feedbackEl.textContent = 'Incorrect. The right answer is highlighted in green.';
                        feedbackEl.className = 'feedback mt-3 text-sm font-semibold text-red-600';
                    }
                }
            });

            if (quizContainer) {
                renderQuiz();
            }

            // Chart.js Simulation
            const ctx = document.getElementById('occupancyChart')?.getContext('2d');
            let occupancyChart;

            const initialData = {
                labels: ['8am', '9am', '10am', '11am', '12pm', '1pm', '2pm', '3pm', '4pm', '5pm', '6pm', '7pm', '8pm'],
                datasets: [{
                    label: 'Occupied Slots',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    backgroundColor: 'rgba(14, 165, 233, 0.2)',
                    borderColor: 'rgba(14, 165, 233, 1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true
                }]
            };

            function createChart() {
                 if (!ctx) return;
                if (occupancyChart) {
                    occupancyChart.destroy();
                }
                occupancyChart = new Chart(ctx, {
                    type: 'line',
                    data: initialData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: { display: true, text: 'Number of Cars' }
                            },
                            x: {
                                title: { display: true, text: 'Time of Day' }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Parking Lot Occupancy (Total Slots: 100)',
                                font: { size: 16, family: 'Lexend' }
                            }
                        }
                    }
                });
            }
            
            const simulateBtn = document.getElementById('simulateDayBtn');
            if (simulateBtn) {
                 simulateBtn.addEventListener('click', () => {
                    if(!occupancyChart) return;
                    const simulatedData = [10, 25, 45, 60, 85, 95, 90, 75, 60, 50, 30, 15, 5];
                    occupancyChart.data.datasets[0].data = simulatedData;
                    occupancyChart.update();
                });
            }

            createChart();

        });
    </script>
</body>
</html>

