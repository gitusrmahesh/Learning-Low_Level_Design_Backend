<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 60: Final Capstone – End-to-End Backend System</title>
    <!-- Chosen Palette: Slate & Sky -->
    <!-- Application Structure Plan: The application is designed as a single-page, vertically flowing lesson with a sticky table of contents (TOC) on the right for easy navigation. This structure is ideal for a dense, educational topic as it allows users to both follow the logical progression of the material and jump directly to specific sections of interest. The flow moves from high-level theory (Core Concepts) to visual architecture (System Blueprint), then to detailed design (UML/Schema), practical implementation (Coding), and finally to self-assessment (Quiz & Challenge). This top-down approach reinforces learning by building context before diving into details. Interactive elements like accordions for theory, clickable diagrams for architecture, and tabs for coding examples are used to manage information density and keep the user engaged, preventing overwhelm. -->
    <!-- Visualization & Content Choices: The application uses a variety of interactive methods to present the report's content without using SVG or Mermaid JS. 1) System Architecture: Represented by an interactive HTML/CSS diagram where clicking components reveals details, which is more engaging than a static image. Goal: Organize/Inform. Method: HTML/CSS/JS. 2) CI/CD Pipeline: A visual flowchart built with HTML/CSS to clarify the process flow. Goal: Change/Process. Method: HTML/CSS. 3) Scalability Chart: A Chart.js bar chart dynamically illustrates system performance under stress, making an abstract concept concrete. Goal: Compare/Inform. Method: Chart.js Canvas. 4) UML Diagrams: Recreated using styled HTML divs within a tabbed interface, providing necessary visuals while adhering to constraints. Goal: Organize/Relationships. Method: HTML/CSS/JS. This multi-faceted approach ensures each piece of information is presented in its most effective, interactive format to maximize user understanding. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .font-lexend {
            font-family: 'Lexend', sans-serif;
        }
        .toc-link.active {
            color: #0ea5e9;
            font-weight: 600;
            border-left-color: #0ea5e9;
        }
        .code-block {
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #475569;
            color: #e2e8f0;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.25rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .code-block:hover .copy-button {
            opacity: 1;
        }
        details > summary {
            cursor: pointer;
            list-style-type: none;
        }
         details > summary::-webkit-details-marker {
            display: none;
        }
        details > summary::before {
            content: '+';
            font-weight: bold;
            margin-right: 0.75rem;
            display: inline-block;
            transition: transform 0.2s;
        }
        details[open] > summary::before {
            transform: rotate(45deg);
        }
        details[open] > summary {
           color: #0f172a;
        }
        .quiz-option:checked + label {
            border-color: #0ea5e9;
            background-color: #f0f9ff;
        }
    </style>
</head>
<body class="text-slate-700">

    <div class="bg-slate-100/80 border-b border-slate-200">
        <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 relative">
            <header class="text-center">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-800 mt-1 tracking-tight font-lexend">Low-Level Design Bootcamp</h1>
                <p class="mt-3 text-slate-600 max-w-xl mx-auto">Your 60-Day Interactive Roadmap to Mastering Backend Engineering.</p>
            </header>
            <a href="roadmap.html?week=9" class="absolute top-1/2 -translate-y-1/2 right-4 sm:right-6 lg:right-8 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">
                Return to Homepage
            </a>
        </div>
    </div>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="flex flex-col lg:flex-row gap-12">
            
            <div class="w-full lg:w-3/4 space-y-16">
                
                <section id="introduction">
                    <h2 class="text-3xl font-bold text-slate-900 font-lexend mb-2">Day 60: Final Capstone</h2>
                    <p class="text-lg text-slate-600">End-to-End Backend System Integration</p>
                    <p class="mt-4 text-base leading-relaxed">
                        Welcome to the culmination of your 60-day journey. Today, we bring together every concept you've mastered—from Object-Oriented Programming to complex Design Patterns—to design and build a robust, scalable, and resilient backend system. This capstone is not just an exercise; it's a simulation of real-world backend engineering, challenging you to think about the entire lifecycle of a service, from design and implementation to deployment and maintenance. We will architect an "Amazon-lite" e-commerce platform, applying advanced principles to ensure it can handle high traffic, recover from failures, and be maintained efficiently.
                    </p>
                </section>

                <section id="theory">
                    <h2 class="text-3xl font-bold text-slate-900 font-lexend mb-6">In-Depth Theoretical Pillars</h2>
                    <div class="space-y-4">
                        <details class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <summary class="font-semibold text-lg text-slate-800">Synergy of Concepts: The Complete Picture</summary>
                            <div class="mt-4 pt-4 border-t border-slate-200 text-slate-600 leading-relaxed space-y-4">
                                <p>A modern backend is not built on a single idea, but on the interplay of many. Here’s a deeper look at how these concepts weave together in our "Amazon-lite" project.</p>
                                <div>
                                    <h4 class="font-semibold text-slate-800">OOP & SOLID: The Architectural Bedrock</h4>
                                    <p>OOP helps us model the real world. For example, a `Product` class encapsulates data (name, price) and behavior (IsInStock()). SOLID principles ensure this model is robust. Consider the <strong>Single Responsibility Principle (SRP)</strong>: An `OrderProcessor` class should focus solely on validating and saving an order. It should NOT handle sending confirmation emails. That's a separate concern, belonging to a `NotificationService`. This separation prevents a change in email logic from breaking order processing.</p>
                                    <p class="mt-2">Similarly, the <strong>Open/Closed Principle (OCP)</strong> is vital. Imagine we want to add a new "Prime" shipping option. Instead of modifying our existing `ShippingCalculator` class, we design it to be extensible. We can create an `IShippingStrategy` interface and implement `StandardShipping` and `PrimeShipping` classes. The calculator uses the interface, allowing us to add new shipping types without touching the core, tested logic.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-slate-800">Design Patterns: Reusable Solutions</h4>
                                    <p>Patterns provide elegant solutions to common problems. The <strong>Observer Pattern</strong> is perfect for decoupling. When an order's status changes to "Shipped", the `OrderService` (the "Subject") doesn't need to know about the `NotificationService`, `InventoryService`, or `AnalyticsService`. It simply emits an `OrderShipped` event. Any number of "Observers" can subscribe to this event and react accordingly, promoting a highly modular, event-driven architecture.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-slate-800">APIs & MVC: The System's Gateway</h4>
                                    <p>The API is the public face of our backend. A request like `GET /api/v1/products/123` is handled by the MVC pattern. The routing directs it to a `ProductsController` (Controller). The controller calls the business logic layer to fetch product data, which uses a `Product` class (Model). This model is then serialized into a JSON response (the "View" in an API context) and sent back to the client.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-slate-800">Multithreading & Async Operations: The Performance Engine</h4>
                                    <p>To keep the API responsive, long-running tasks must be offloaded. When an order is placed, we can't make the user wait while we process payment, update inventory, and send an email. The controller should quickly validate the request, save the initial order state, and then publish tasks to a <strong>message queue</strong> (like RabbitMQ or Kafka). Separate worker processes (consumers), running on their own threads, pick up these tasks and execute them in the background. This is the <strong>Producer-Consumer pattern</strong>, a cornerstone of scalable systems.</p>
                                </div>
                            </div>
                        </details>
                        
                        <details class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <summary class="font-semibold text-lg text-slate-800">Advanced Scalability & Fault-Tolerance</summary>
                            <div class="mt-4 pt-4 border-t border-slate-200 text-slate-600 leading-relaxed space-y-4">
                                <div>
                                    <h4 class="font-semibold text-slate-800">Deep Dive into Scalability</h4>
                                    <p><strong>Horizontal Scaling</strong> (adding more machines) is preferred for modern web apps because it offers near-limitless growth and fault tolerance. A critical component is the <strong>Load Balancer</strong>. It acts as a traffic cop, sitting in front of your servers and distributing incoming requests among them using algorithms like Round Robin or Least Connections. This prevents any single server from becoming a bottleneck.</p>
                                    <p class="mt-2"><strong>Database Scaling</strong> is also crucial. A common strategy is using <strong>Read Replicas</strong>. All write operations (INSERT, UPDATE) go to a primary database, which then replicates the data to one or more read-only copies. Read-heavy operations (like fetching product listings) can be directed to these replicas, significantly reducing the load on the primary database.</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-slate-800">Engineering for Fault-Tolerance</h4>
                                    <p>Failure is inevitable in distributed systems. We plan for it using patterns like the <strong>Circuit Breaker</strong>. Imagine our `OrderService` calls a third-party `PaymentGateway`. If the gateway is slow or down, we don't want to keep hammering it with requests, wasting resources and potentially cascading the failure. The Circuit Breaker acts like an electrical one: after a few failures, it "trips" and immediately fails any further calls for a while, giving the downstream service time to recover. This prevents a localized failure from taking down the entire system.</p>
                                    <p class="mt-2">Combined with intelligent <strong>Retries with Exponential Backoff</strong> (waiting longer between each retry attempt), this makes the system incredibly resilient.</p>
                                </div>
                                <div class="mt-6">
                                    <h4 class="font-semibold text-slate-800 mb-2">System Performance Under Stress</h4>
                                    <div class="p-4 bg-slate-50 rounded-lg">
                                        <div class="chart-container" style="position: relative; height:350px; width:100%; max-width: 600px; margin: auto;">
                                            <canvas id="scalabilityChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </details>

                        <details class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <summary class="font-semibold text-lg text-slate-800">Comprehensive Observability</summary>
                            <div class="mt-4 pt-4 border-t border-slate-200 text-slate-600 leading-relaxed space-y-4">
                                <div>
                                    <h4 class="font-semibold text-slate-800">Structured Logging for Traceability</h4>
                                    <p>In a microservices architecture, a single user request might travel through multiple services. To debug issues, we need to trace this entire journey. We achieve this with <strong>structured logging</strong> and a <strong>Correlation ID</strong>. When a request first enters our system, we generate a unique ID (e.g., a GUID) and include it in every log message produced while processing that request, even as it passes from one service to another. This allows us to filter our logs and see the complete, ordered story of a single transaction.</p>
                                    <p class="mt-2">Example of a structured log entry:</p>
                                    <pre class="bg-slate-800 text-white p-3 rounded-md text-xs mt-2"><code>{
  "timestamp": "2025-09-22T11:43:00Z",
  "level": "INFO",
  "service": "OrderService",
  "correlationId": "abc-123-xyz-789",
  "message": "Order 54321 successfully validated."
}</code></pre>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-slate-800">The RED Method for Service Metrics</h4>
                                    <p>For monitoring services, the RED method provides a simple, powerful framework:</p>
                                    <ul class="list-disc list-inside space-y-1 mt-2">
                                        <li><strong>Rate:</strong> The number of requests per second the service is handling.</li>
                                        <li><strong>Errors:</strong> The number of failed requests per second.</li>
                                        <li><strong>Duration:</strong> The distribution of time each request takes to complete (e.g., latency percentiles like p95, p99).</li>
                                    </ul>
                                    <p>Monitoring these three metrics gives you an immediate, high-level understanding of your service's health.</p>
                                </div>
                            </div>
                        </details>
                        
                        <details class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                            <summary class="font-semibold text-lg text-slate-800">Advanced CI/CD Pipeline Concepts</summary>
                            <div class="mt-4 pt-4 border-t border-slate-200 text-slate-600 leading-relaxed space-y-4">
                                <div>
                                    <h4 class="font-semibold text-slate-800">The 'Test' Stage: A Safety Net</h4>
                                    <p>This is more than just running a few checks. A mature test stage includes a pyramid of tests:</p>
                                    <ul class="list-disc list-inside space-y-1 mt-2">
                                        <li><strong>Unit Tests:</strong> Fast tests that check individual functions or classes in isolation.</li>
                                        <li><strong>Integration Tests:</strong> Verify that different components of your service work together (e.g., does the controller correctly call the service layer and interact with a test database?).</li>
                                        <li><strong>End-to-End (E2E) Tests:</strong> Automated tests that simulate a full user journey through the application.</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-slate-800">Smart Deployment Strategies</h4>
                                    <p>Pushing code directly to all users is risky. Modern CI/CD pipelines use safer strategies:</p>
                                    <ul class="list-disc list-inside space-y-1 mt-2">
                                        <li><strong>Blue-Green Deployment:</strong> You have two identical production environments ("Blue" and "Green"). If Blue is live, you deploy the new code to Green. Once it's tested, you switch the router to send all traffic to Green. This allows for instant, zero-downtime deployments and rollbacks.</li>
                                        <li><strong>Canary Releases:</strong> You release the new version to a small subset of users (the "canaries"). You monitor key metrics for this group. If everything looks good, you gradually roll out the change to the rest of your users. This minimizes the impact of any potential bugs.</li>
                                    </ul>
                                </div>
                                <div class="flex flex-wrap items-center justify-center gap-2 sm:gap-0 mt-6 text-center">
                                    <div class="flex-shrink-0 p-3 bg-sky-100 text-sky-800 rounded-lg shadow-sm w-32">
                                        <p class="font-bold">Commit</p>
                                        <p class="text-xs">Developer pushes code</p>
                                    </div>
                                    <div class="w-10 h-1 bg-slate-300 hidden sm:block"></div>
                                    <div class="flex-shrink-0 p-3 bg-sky-100 text-sky-800 rounded-lg shadow-sm w-32">
                                        <p class="font-bold">Build</p>
                                        <p class="text-xs">Code is compiled</p>
                                    </div>
                                    <div class="w-10 h-1 bg-slate-300 hidden sm:block"></div>
                                    <div class="flex-shrink-0 p-3 bg-sky-100 text-sky-800 rounded-lg shadow-sm w-32">
                                        <p class="font-bold">Test</p>
                                        <p class="text-xs">Unit & Integration tests run</p>
                                    </div>
                                    <div class="w-10 h-1 bg-slate-300 hidden sm:block"></div>
                                    <div class="flex-shrink-0 p-3 bg-sky-100 text-sky-800 rounded-lg shadow-sm w-32">
                                        <p class="font-bold">Deploy</p>
                                        <p class="text-xs">Pushed to production</p>
                                    </div>
                                    <div class="w-10 h-1 bg-slate-300 hidden sm:block"></div>
                                    <div class="flex-shrink-0 p-3 bg-sky-100 text-sky-800 rounded-lg shadow-sm w-32">
                                        <p class="font-bold">Monitor</p>
                                        <p class="text-xs">Observe performance</p>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                </section>

                <section id="uml">
                    <h2 class="text-3xl font-bold text-slate-900 font-lexend mb-6">Detailed System Blueprints: UML & Schema</h2>
                    <p class="mb-6">Before writing code, we design the blueprint. The following diagrams represent the structure and relationships within our "Amazon-lite" system. They provide a clear, high-level overview for all stakeholders and serve as a guide during implementation.</p>
                    <div>
                        <div class="border-b border-slate-200">
                            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                                <button class="tab-button active text-sky-600 border-sky-500 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-target="class-diagram">Class Diagram</button>
                                <button class="tab-button text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-target="er-diagram">ER Diagram</button>
                                <button class="tab-button text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" data-target="sequence-diagram">Sequence Diagram</button>
                            </nav>
                        </div>
                        <div class="mt-6">
                            <div id="class-diagram" class="tab-content">
                                <h3 class="font-semibold text-lg text-slate-800 mb-2">Class Diagram</h3>
                                <p class="mb-4">This diagram models the key objects and their static relationships. `User` and `Order` have a one-to-many association. An `Order` is composed of one or more `OrderLineItem` objects, meaning line items cannot exist without an order.</p>
                                <div class="p-4 bg-white rounded-lg border border-slate-200 text-xs font-mono flex flex-wrap gap-4 justify-center">
                                    <div class="border border-slate-400 bg-slate-50 w-48">
                                        <div class="p-1 font-bold bg-slate-200 text-center">User</div>
                                        <div class="p-1 border-t border-slate-400">- UserId: int<br>- Username: string</div>
                                        <div class="p-1 border-t border-slate-400">+ GetOrders()</div>
                                    </div>
                                    <div class="border border-slate-400 bg-slate-50 w-56">
                                        <div class="p-1 font-bold bg-slate-200 text-center">Order</div>
                                        <div class="p-1 border-t border-slate-400">- OrderId: int<br>- UserId: int<br>- OrderDate: DateTime</div>
                                        <div class="p-1 border-t border-slate-400">+ AddLineItem(product, qty)<br>+ CalculateTotal()</div>
                                    </div>
                                    <div class="border border-slate-400 bg-slate-50 w-56">
                                        <div class="p-1 font-bold bg-slate-200 text-center">OrderLineItem</div>
                                        <div class="p-1 border-t border-slate-400">- ProductId: int<br>- Quantity: int<br>- UnitPrice: decimal</div>
                                    </div>
                                    <div class="border border-slate-400 bg-slate-50 w-48">
                                        <div class="p-1 font-bold bg-slate-200 text-center">Product</div>
                                        <div class="p-1 border-t border-slate-400">- ProductId: int<br>- Name: string<br>- Price: decimal</div>
                                    </div>
                                </div>
                            </div>
                            <div id="er-diagram" class="tab-content hidden">
                                <h3 class="font-semibold text-lg text-slate-800 mb-2">Entity-Relationship (ER) Diagram</h3>
                                <p class="mb-4">The ER diagram models the database schema, detailing tables, columns, and key constraints. PK denotes a Primary Key, and FK denotes a Foreign Key, which establishes the link between tables.</p>
                                <div class="p-4 bg-white rounded-lg border border-slate-200 text-xs flex flex-wrap gap-4 justify-center items-start">
                                    <div class="border border-slate-500 w-40">
                                        <div class="font-bold bg-slate-200 p-1">Users</div>
                                        <div class="p-1"><strong>user_id (PK)</strong><br>username<br>email<br>password_hash</div>
                                    </div>
                                    <div class="border border-slate-500 w-40">
                                        <div class="font-bold bg-slate-200 p-1">Orders</div>
                                        <div class="p-1"><strong>order_id (PK)</strong><br><em>user_id (FK)</em><br>order_date<br>status</div>
                                    </div>
                                    <div class="border border-slate-500 w-40">
                                        <div class="font-bold bg-slate-200 p-1">OrderItems</div>
                                        <div class="p-1"><strong>item_id (PK)</strong><br><em>order_id (FK)</em><br><em>product_id (FK)</em><br>quantity<br>price</div>
                                    </div>
                                    <div class="border border-slate-500 w-40">
                                        <div class="font-bold bg-slate-200 p-1">Products</div>
                                        <div class="p-1"><strong>product_id (PK)</strong><br>name<br>description<br>price<br>stock_count</div>
                                    </div>
                                </div>
                            </div>
                            <div id="sequence-diagram" class="tab-content hidden">
                                <h3 class="font-semibold text-lg text-slate-800 mb-2">Sequence Diagram: Placing an Order</h3>
                                <p class="mb-4">This diagram shows the dynamic interaction between components for a successful order placement, including an alternative flow for an out-of-stock scenario using an 'alt' fragment.</p>
                                <div class="p-4 bg-white rounded-lg border border-slate-200 text-xs overflow-x-auto">
                                   <div class="flex justify-between text-center font-semibold gap-4 min-w-[600px]">
                                       <div>Client</div>
                                       <div>Order Service</div>
                                       <div>Inventory Service</div>
                                       <div>Database</div>
                                   </div>
                                   <div class="mt-4 space-y-2 text-slate-600 min-w-[600px]">
                                       <p class="relative">1. POST /orders(items) <span class="absolute left-0 w-1/3 top-1/2 -mt-px h-px bg-slate-400"></span><span class="absolute right-2/3 top-1/2 -mt-1 w-2 h-2 border-r-2 border-b-2 border-slate-400 rotate-[-45deg]"></span></p>
                                       <p class="relative pl-[33%]">2. checkStock(items) <span class="absolute left-1/3 w-1/3 top-1/2 -mt-px h-px bg-slate-400"></span><span class="absolute right-1/3 top-1/2 -mt-1 w-2 h-2 border-r-2 border-b-2 border-slate-400 rotate-[-45deg]"></span></p>
                                       <div class="border-2 border-sky-500 rounded p-2 my-2">
                                           <p class="font-bold text-sky-600">alt [stock available]</p>
                                           <p class="relative pl-[33%] mt-2">3a. return true <span class="absolute left-1/3 w-1/3 top-1/2 -mt-px h-px bg-slate-400 border-t border-dashed"></span><span class="absolute left-1/3 top-1/2 -mt-1 w-2 h-2 border-l-2 border-t-2 border-slate-400 rotate-[-45deg]"></span></p>
                                           <p class="relative pl-[33%]">4a. createOrderInDB() <span class="absolute left-1/3 w-2/3 top-1/2 -mt-px h-px bg-slate-400"></span><span class="absolute right-0 top-1/2 -mt-1 w-2 h-2 border-r-2 border-b-2 border-slate-400 rotate-[-45deg]"></span></p>
                                           <p class="relative">5a. return 201 Created <span class="absolute left-0 w-1/3 top-1/2 -mt-px h-px bg-slate-400 border-t border-dashed"></span><span class="absolute left-0 top-1/2 -mt-1 w-2 h-2 border-l-2 border-t-2 border-slate-400 rotate-[-45deg]"></span></p>
                                       </div>
                                       <div class="border-2 border-amber-500 rounded p-2 my-2">
                                           <p class="font-bold text-amber-600">alt [stock unavailable]</p>
                                           <p class="relative pl-[33%] mt-2">3b. return false <span class="absolute left-1/3 w-1/3 top-1/2 -mt-px h-px bg-slate-400 border-t border-dashed"></span><span class="absolute left-1/3 top-1/2 -mt-1 w-2 h-2 border-l-2 border-t-2 border-slate-400 rotate-[-45deg]"></span></p>
                                           <p class="relative">4b. return 409 Conflict <span class="absolute left-0 w-1/3 top-1/2 -mt-px h-px bg-slate-400 border-t border-dashed"></span><span class="absolute left-0 top-1/2 -mt-1 w-2 h-2 border-l-2 border-t-2 border-slate-400 rotate-[-45deg]"></span></p>
                                       </div>
                                   </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section id="coding">
                    <h2 class="text-3xl font-bold text-slate-900 font-lexend mb-6">Coding Practice & Implementation</h2>
                    <p class="mb-6">This section provides the practical C# code for implementing the core modules of our backend system. Each example is a self-contained solution to a specific challenge, moving from foundational authentication to advanced concurrency handling.</p>
                    <div class="bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="font-semibold text-lg text-slate-800 mb-1">[Easy] Build Authentication Module</h3>
                        <p class="text-sm text-slate-500 mb-4">A simple JWT-based authentication service. A JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties.</p>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
                            <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
// A "Claim" is a piece of information asserted about a subject. 
// Here, we're claiming the user's ID.
using System.Security.Claims;

public class AuthService
{
    private readonly IUserRepository _userRepository;
    private readonly string _jwtSecret; // Should be stored securely, e.g., in app settings

    public string Register(string username, string password)
    {
        // Use a strong, one-way hashing algorithm for passwords. Never store them in plain text.
        var hashedPassword = BCrypt.Net.BCrypt.HashPassword(password);
        var user = new User { Username = username, HashedPassword = hashedPassword };
        _userRepository.Add(user);
        return GenerateJwtToken(user);
    }

    private string GenerateJwtToken(User user)
    {
        var tokenHandler = new JwtSecurityTokenHandler();
        var key = Encoding.ASCII.GetBytes(_jwtSecret);
        var tokenDescriptor = new SecurityTokenDescriptor
        {
            // The token's payload contains claims. Here we add the user's ID.
            // The API can then trust this ID without needing another DB lookup.
            Subject = new ClaimsIdentity(new[] { new Claim("id", user.Id.ToString()) }),
            Expires = DateTime.UtcNow.AddDays(7),
            SigningCredentials = new SigningCredentials(new SymmetricSecurityKey(key), SecurityAlgorithms.HmacSha256Signature)
        };
        var token = tokenHandler.CreateToken(tokenDescriptor);
        return tokenHandler.WriteToken(token);
    }
}
                            </code></pre>
                        </div>
                    </div>
                    <div class="bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-slate-200 mt-6">
                        <h3 class="font-semibold text-lg text-slate-800 mb-1">[Medium] Add Caching & Background Jobs</h3>
                        <p class="text-sm text-slate-500 mb-4">This demonstrates the Cache-Aside pattern, where the application code is responsible for reading and writing to the cache. We also offload slow tasks to a message queue.</p>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
                            <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
// Caching with Redis using the Cache-Aside Pattern
public class ProductService
{
    public async Task<Product> GetProductById(int id)
    {
        string cacheKey = $"product:{id}";
        // 1. Attempt to get the item from the cache.
        string cachedProduct = await _redisCache.StringGetAsync(cacheKey);

        if (!string.IsNullOrEmpty(cachedProduct))
        {
            // 2. Cache hit: Deserialize and return the data.
            return JsonSerializer.Deserialize<Product>(cachedProduct);
        }

        // 3. Cache miss: Get data from the primary data source (database).
        var product = await _productRepo.GetByIdAsync(id);
        if (product != null)
        {
            // 4. Store the data in the cache with an expiration time (TTL).
            await _redisCache.StringSetAsync(cacheKey, JsonSerializer.Serialize(product), TimeSpan.FromMinutes(10));
        }
        return product;
    }
}

// Background Job with RabbitMQ (Producer)
public class OrderService
{
    public void PlaceOrder(Order order)
    {
        // ... business logic to save order to DB ...

        // Publish an event. This is a "fire and forget" operation.
        // The OrderService's job is done, ensuring a fast API response for the user.
        var paymentEvent = new { OrderId = order.Id, Amount = order.TotalAmount };
        _publisher.Publish("payment_processing_queue", JsonSerializer.Serialize(paymentEvent));
    }
}
                            </code></pre>
                        </div>
                    </div>
                     <div class="bg-white p-4 sm:p-6 rounded-lg shadow-sm border border-slate-200 mt-6">
                        <h3 class="font-semibold text-lg text-slate-800 mb-1">[Hard] Handle Concurrency in Distributed Environment</h3>
                        <p class="text-sm text-slate-500 mb-4">A "race condition" occurs when multiple server instances try to update the same product stock simultaneously, leading to incorrect data. A distributed lock ensures only one process can perform the critical stock update at a time.</p>
                        <div class="code-block">
                            <button class="copy-button" onclick="copyToClipboard(this)">Copy</button>
                            <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
public class InventoryService
{
    public async Task<bool> DecreaseStock(int productId, int quantity)
    {
        // A unique key for this specific product's lock.
        var lockKey = $"lock:product:{productId}";
        // A unique value to ensure we only release a lock that we acquired.
        var lockToken = Guid.NewGuid().ToString();
        
        // Try to acquire the lock from Redis. This is an atomic operation.
        if (await _redisDb.LockTakeAsync(lockKey, lockToken, TimeSpan.FromSeconds(10)))
        {
            try
            {
                // This is the "critical section". Only one process can execute this code at a time for a given product.
                // 1. Read the current stock.
                var product = await _productRepo.GetByIdAsync(productId);
                if (product.Stock < quantity)
                {
                    return false; // Not enough stock
                }

                // 2. Perform the update.
                product.Stock -= quantity;
                await _productRepo.UpdateAsync(product);
                return true;
            }
            finally
            {
                // It's crucial to release the lock in a 'finally' block
                // to ensure it gets released even if an exception occurs.
                await _redisDb.LockReleaseAsync(lockKey, lockToken);
            }
        }
        else
        {
            // Could not acquire lock. The application should handle this gracefully,
            // perhaps by telling the user to try again in a moment.
            return false;
        }
    }
}
                            </code></pre>
                        </div>
                    </div>
                </section>
                
                <section id="quiz">
                    <h2 class="text-3xl font-bold text-slate-900 font-lexend mb-6">Knowledge Check</h2>
                    <div class="space-y-6 bg-white p-6 rounded-lg border border-slate-200">
                        <div class="quiz-question">
                            <p class="font-semibold">1. Which SOLID principle is violated if an `OrderProcessor` class also sends confirmation emails?</p>
                            <div class="mt-2 space-y-2">
                                <div><input type="radio" id="q1a" name="q1" value="a" class="hidden quiz-option"><label for="q1a" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">a) Open/Closed Principle</label></div>
                                <div><input type="radio" id="q1b" name="q1" value="b" class="hidden quiz-option"><label for="q1b" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">b) Single Responsibility Principle</label></div>
                                <div><input type="radio" id="q1c" name="q1" value="c" class="hidden quiz-option"><label for="q1c" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">c) Liskov Substitution Principle</label></div>
                            </div>
                            <div class="mt-3 hidden quiz-feedback text-sm" data-question="q1" data-answer="b"></div>
                        </div>

                         <div class="quiz-question pt-4 border-t border-slate-200">
                            <p class="font-semibold">2. What is the role of a Load Balancer in a horizontally scaled system?</p>
                            <div class="mt-2 space-y-2">
                                <div><input type="radio" id="q2a" name="q2" value="a" class="hidden quiz-option"><label for="q2a" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">a) To cache database queries.</label></div>
                                <div><input type="radio" id="q2b" name="q2" value="b" class="hidden quiz-option"><label for="q2b" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">b) To distribute incoming traffic across multiple server instances.</label></div>
                                <div><input type="radio" id="q2c" name="q2" value="c" class="hidden quiz-option"><label for="q2c" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">c) To run background jobs asynchronously.</label></div>
                            </div>
                            <div class="mt-3 hidden quiz-feedback text-sm" data-question="q2" data-answer="b"></div>
                        </div>
                        
                         <div class="quiz-question pt-4 border-t border-slate-200">
                            <p class="font-semibold">3. A Circuit Breaker pattern is primarily used to enhance a system's...</p>
                             <div class="mt-2 space-y-2">
                                <div><input type="radio" id="q3a" name="q3" value="a" class="hidden quiz-option"><label for="q3a" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">a) Security</label></div>
                                <div><input type="radio" id="q3b" name="q3" value="b" class="hidden quiz-option"><label for="q3b" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">b) Database performance</label></div>
                                <div><input type="radio" id="q3c" name="q3" value="c" class="hidden quiz-option"><label for="q3c" class="block p-3 border-2 border-slate-200 rounded-lg cursor-pointer hover:bg-slate-50">c) Fault-tolerance</label></div>
                            </div>
                            <div class="mt-3 hidden quiz-feedback text-sm" data-question="q3" data-answer="c"></div>
                        </div>

                        <button id="check-quiz" class="bg-sky-500 text-white font-semibold py-2 px-6 rounded-lg hover:bg-sky-600 transition-colors">Check Answers</button>
                    </div>
                </section>

                <section id="challenge">
                    <h2 class="text-3xl font-bold text-slate-900 font-lexend mb-6">Self-Assessment Challenge</h2>
                    <div class="bg-white p-6 rounded-lg border border-slate-200">
                        <p class="font-semibold text-slate-800">Your Challenge: Design the "Notification Service"</p>
                        <p class="mt-2">Based on the "Amazon-lite" case study, design a `NotificationService`. This service should be responsible for sending emails to users for events like "Order Confirmed" and "Order Shipped".</p>
                        <p class="mt-3 font-medium">Requirements:</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-slate-600">
                            <li>The service must be <strong>decoupled</strong> from the `OrderService`. The `OrderService` should not have to wait for an email to be sent.</li>
                            <li>The service must be <strong>resilient</strong>. If an email fails to send, it should be retried automatically a few times.</li>
                            <li>Create a simple Class Diagram for your proposed design and provide pseudo-code for the worker.</li>
                        </ul>
                        <button id="reveal-solution" class="mt-6 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">Reveal Solution</button>
                        <div id="solution" class="hidden mt-6 pt-6 border-t border-slate-200">
                            <h3 class="font-bold text-lg text-slate-900">Solution Breakdown</h3>
                            <p class="mt-2">A robust solution involves using a message queue and a dedicated worker service, embodying the Producer-Consumer pattern.</p>
                            <ol class="list-decimal list-inside mt-2 space-y-2">
                                <li><strong>Decoupling with a Message Queue:</strong> The `OrderService` (Producer) will not call the `NotificationService` directly. Instead, it will publish a message (e.g., `OrderConfirmedEvent` containing `OrderId`, `UserEmail`, `UserName`) to a dedicated message queue topic called `notification_events`.</li>
                                <li><strong>Dedicated Worker (Consumer):</strong> A separate, independently running `NotificationWorker` service will subscribe to and listen for messages on this queue. When it receives a message, it will attempt to process it by calling the actual email sending logic.</li>
                                <li><strong>Resiliency and Retries:</strong> Message queues provide natural resiliency. If the `NotificationWorker` is down, messages accumulate in the queue. Most queue systems also support a Dead-Letter Queue (DLQ). If a message fails processing a certain number of times (e.g., 3 retries), it is automatically moved to the DLQ for later manual inspection, preventing a poison message from blocking the queue.</li>
                            </ol>
                            <h4 class="font-semibold mt-4 mb-2">Class Diagram:</h4>
                             <div class="p-4 bg-slate-50 rounded-lg text-xs font-mono flex flex-wrap gap-4 justify-center">
                                <div class="border border-slate-400 bg-white w-48"><div class="p-1 font-bold bg-slate-200 text-center">OrderService</div><div class="p-1 border-t border-slate-400">- _publisher: IMessageQueue</div><div class="p-1 border-t border-slate-400">+ ConfirmOrder(order)</div></div>
                                <div class="border border-slate-400 bg-white w-48"><div class="p-1 font-bold bg-slate-200 text-center">NotificationWorker</div><div class="p-1 border-t border-slate-400">- _emailClient: IEmailClient</div><div class="p-1 border-t border-slate-400">+ OnMessageReceived(event)</div></div>
                                <div class="border border-slate-400 bg-white w-48"><div class="p-1 font-bold bg-slate-200 text-center">IEmailClient</div><div class="p-1 border-t border-slate-400"></div><div class="p-1 border-t border-slate-400">+ SendEmailAsync(to, subject, body)</div></div>
                            </div>
                            <h4 class="font-semibold mt-4 mb-2">Pseudo-code for Worker:</h4>
                            <pre class="bg-slate-800 text-white p-3 rounded-md text-xs mt-2"><code>
class NotificationWorker {
    function listen_on_queue(queue_name) {
        while (true) {
            message = queue.get_message(queue_name);
            if (message) {
                try {
                    send_notification(message.body);
                    queue.acknowledge(message); // Mark as processed
                } catch (error) {
                    log_error(error);
                    // Queue will handle retry logic based on configuration
                }
            }
        }
    }

    function send_notification(event_data) {
        // ... Logic to format and send email using IEmailClient ...
    }
}
                            </code></pre>
                        </div>
                    </div>
                </section>

            </div>

            <!-- Sticky Table of Contents -->
            <aside class="w-full lg:w-1/4 lg:sticky top-8 self-start">
                <div class="p-6 bg-white rounded-lg border border-slate-200 shadow-sm">
                    <h3 class="font-bold text-lg text-slate-900 font-lexend mb-4">On This Page</h3>
                    <nav class="space-y-2">
                        <a href="#introduction" class="block text-slate-600 hover:text-sky-600 border-l-2 border-slate-200 pl-4 py-1 text-sm toc-link">Introduction</a>
                        <a href="#theory" class="block text-slate-600 hover:text-sky-600 border-l-2 border-slate-200 pl-4 py-1 text-sm toc-link">In-Depth Theory</a>
                        <a href="#uml" class="block text-slate-600 hover:text-sky-600 border-l-2 border-slate-200 pl-4 py-1 text-sm toc-link">System Blueprints</a>
                        <a href="#coding" class="block text-slate-600 hover:text-sky-600 border-l-2 border-slate-200 pl-4 py-1 text-sm toc-link">Coding Practice</a>
                        <a href="#quiz" class="block text-slate-600 hover:text-sky-600 border-l-2 border-slate-200 pl-4 py-1 text-sm toc-link">Knowledge Check</a>
                        <a href="#challenge" class="block text-slate-600 hover:text-sky-600 border-l-2 border-slate-200 pl-4 py-1 text-sm toc-link">Challenge</a>
                    </nav>
                </div>
            </aside>
        </div>
    </main>

    <footer class="text-center mt-16 py-8 border-t border-slate-200">
        <p class="text-slate-700 font-semibold">Low-Level Design Bootcamp</p>
        <p class="text-sm text-slate-500 mt-2">A personalized learning roadmap curated by Mr. Mahesh Singare.</p>
        <p class="text-xs text-slate-400 mt-4">&copy; 2025. All Rights Reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        window.copyToClipboard = function(button) {
            const codeBlock = button.nextElementSibling;
            const text = codeBlock.innerText;
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            button.innerText = 'Copied!';
            setTimeout(() => { button.innerText = 'Copy'; }, 2000);
        }

        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'text-sky-600', 'border-sky-500');
                    btn.classList.add('text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300');
                });
                button.classList.add('active', 'text-sky-600', 'border-sky-500');
                button.classList.remove('text-slate-500', 'hover:text-slate-700', 'hover:border-slate-300');
                tabContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });
        
        const ctx = document.getElementById('scalabilityChart').getContext('2d');
        const scalabilityChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['1k Req/s', '5k Req/s', '10k Req/s', '10k Req/s (Failure)'],
                datasets: [{
                    label: 'Scalable System Response Time (ms)',
                    data: [50, 65, 80, 85],
                    backgroundColor: 'rgba(56, 189, 248, 0.6)',
                    borderColor: 'rgba(14, 165, 233, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }, {
                    label: 'Non-Scalable System Response Time (ms)',
                    data: [55, 250, 1500, 1600],
                     backgroundColor: 'rgba(244, 63, 94, 0.6)',
                    borderColor: 'rgba(225, 29, 72, 1)',
                    borderWidth: 1,
                    yAxisID: 'y',
                    hidden: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true,
                        title: { display: true, text: 'Response Time (ms)' }
                    }
                },
                plugins: {
                    tooltip: { mode: 'index', intersect: false },
                    title: { display: true, text: 'System Response Time Under Increasing Load' }
                }
            }
        });

        const sections = document.querySelectorAll('section[id]');
        const tocLinks = document.querySelectorAll('.toc-link');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);
                if (entry.isIntersecting && entry.intersectionRatio >= 0.2) {
                    tocLinks.forEach(link => link.classList.remove('active'));
                    tocLink.classList.add('active');
                }
            });
        }, { rootMargin: '-20% 0px -70% 0px', threshold: [0.2, 0.8] });
        sections.forEach(section => { observer.observe(section); });
        
        const checkQuizBtn = document.getElementById('check-quiz');
        checkQuizBtn.addEventListener('click', () => {
            document.querySelectorAll('.quiz-question').forEach(q => {
                const feedbackEl = q.querySelector('.quiz-feedback');
                const qName = feedbackEl.dataset.question;
                const correctAnswer = feedbackEl.dataset.answer;
                const selectedAnswer = document.querySelector(`input[name="${qName}"]:checked`);
                feedbackEl.classList.remove('hidden');
                if (selectedAnswer) {
                    if(selectedAnswer.value === correctAnswer) {
                        feedbackEl.textContent = 'Correct! This demonstrates a key design principle.';
                        feedbackEl.className = 'quiz-feedback mt-3 text-sm text-green-600 font-semibold';
                    } else {
                        feedbackEl.textContent = `Not quite. The correct answer is (${correctAnswer.toUpperCase()}). Review the relevant theory section.`;
                        feedbackEl.className = 'quiz-feedback mt-3 text-sm text-red-600 font-semibold';
                    }
                } else {
                    feedbackEl.textContent = 'Please select an answer.';
                    feedbackEl.className = 'quiz-feedback mt-3 text-sm text-amber-600 font-semibold';
                }
            });
        });

        const revealBtn = document.getElementById('reveal-solution');
        const solutionEl = document.getElementById('solution');
        revealBtn.addEventListener('click', () => {
            solutionEl.classList.toggle('hidden');
            revealBtn.textContent = solutionEl.classList.contains('hidden') ? 'Reveal Solution' : 'Hide Solution';
        });

    });
    </script>
</body>
</html>

