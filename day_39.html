<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 39: Chain of Responsibility - LLD Bootcamp</title>
    <!-- Chosen Palette: Slate & Sky -->
    <!-- Application Structure Plan: A single-column, long-form educational page with a sticky right-hand table of contents for navigation. This linear structure is optimal for a step-by-step lesson, guiding the user from foundational theory to practical application. Interactivity is introduced through a dynamic visualization of the chain process, interactive quizzes, and code-copying features to enhance learning and engagement without disrupting the logical flow of the content. -->
    <!-- Visualization & Content Choices: Report Info: UML Diagram -> Goal: Explain structure -> Viz/Presentation: HTML/CSS diagram -> Interaction: Static -> Justification: Clear, standard representation without external libraries. Report Info: Request Pipeline -> Goal: Demonstrate process -> Viz/Presentation: Interactive HTML/JS animation -> Interaction: User triggers request, sees it travel the chain -> Justification: Actively engages the user and makes the abstract concept of 'passing the request' tangible. Report Info: Coding examples -> Goal: Practical application -> Viz/Presentation: Styled code blocks -> Interaction: Copy-to-clipboard button -> Justification: Improves user experience by making code easy to use. Report Info: Knowledge Check -> Goal: Test understanding -> Viz/Presentation: HTML form -> Interaction: User answers, gets instant feedback -> Justification: Reinforces learning through active recall. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .font-lexend {
            font-family: 'Lexend', sans-serif;
        }
        .toc-link.active {
            color: #0284c7;
            font-weight: 600;
            border-left-color: #0284c7;
        }
        .code-block {
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            padding: 0.3rem 0.6rem;
            border-radius: 0.375rem;
            color: #9ca3af;
            background-color: #374151;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .copy-button:hover {
            color: #e5e7eb;
            background-color: #4b5563;
        }
        .quiz-option.correct {
            background-color: #dcfce7;
            border-color: #22c55e;
        }
        .quiz-option.incorrect {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
        .chain-node {
            transition: all 0.3s ease-in-out;
        }
        .chain-node.active {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            border-color: #0ea5e9;
        }
        .request-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #f59e0b;
            border-radius: 50%;
            z-index: 10;
            transition: all 0.5s ease-in-out;
            opacity: 0;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="bg-slate-100/80 border-b border-slate-200">
        <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 relative">
            <header class="text-center">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-800 mt-1 tracking-tight font-lexend">Low-Level Design Bootcamp</h1>
                <p class="mt-3 text-slate-600 max-w-xl mx-auto">Your 60-Day Interactive Roadmap to Mastering Backend Engineering.</p>
            </header>
            <a href="roadmap.html" class="absolute top-1/2 -translate-y-1/2 right-4 sm:right-6 lg:right-8 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">
                Return to Homepage
            </a>
        </div>
    </div>
    
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 mt-6">
        <div class="flex flex-col lg:flex-row lg:space-x-12">
            
            <div class="lg:w-3/4">
                <article>
                    <header class="mb-10">
                        <p class="text-sm font-semibold text-sky-600">Day 39: Behavioral Patterns</p>
                        <h2 id="intro" class="mt-2 text-4xl font-extrabold tracking-tight font-lexend">Chain of Responsibility Pattern</h2>
                        <p class="mt-4 text-lg text-slate-600">Decouple senders and receivers by giving more than one object a chance to handle the request. Chain the receiving objects and pass the request along the chain until an object handles it.</p>
                    </header>
                    
                    <section id="theory" class="space-y-8 scroll-mt-20">
                        <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">Theory & Core Concepts</h3>
                        <p>The Chain of Responsibility is a behavioral design pattern that lets you pass requests along a chain of handlers. Upon receiving a request, each handler decides either to process the request or to pass it to the next handler in the chain. This pattern is all about loose coupling—the sender of a request doesn't need to know who will ultimately handle it.</p>

                        <div class="bg-sky-50 border-l-4 border-sky-500 p-6 rounded-lg">
                            <h4 class="font-bold text-lg text-sky-800">Analogy: The Customer Service Escalation Line</h4>
                            <p class="mt-2 text-sky-700">Imagine calling a customer service hotline. The first person you speak to is a Level 1 operator. They can handle common, simple issues. If your problem is too complex for them, they don't just hang up; they <strong class="font-semibold">pass your call to a Level 2 specialist</strong>. If the specialist can't solve it, they escalate it to a manager (Level 3). Your request (the call) travels along a chain of handlers (operators, specialists, managers) until one of them has the authority and knowledge to resolve it. You, as the client, only need to know one number to call; you don't care who ultimately fixes the problem.</p>
                        </div>
                    </section>
                    
                    <section id="uml" class="mt-12 space-y-8 scroll-mt-20">
                        <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">UML Diagram & Components</h3>
                        <p>The pattern has four main participants that work together to create the chain.</p>
                        <div class="p-6 bg-white rounded-xl shadow-md border">
                             <div class="flex flex-col items-center justify-center space-y-4">
                                <div class="w-full text-center p-4 bg-amber-100 border border-amber-300 rounded-lg shadow-sm">
                                    <p class="font-bold">Client</p>
                                    <p class="text-sm">Initiates the request to a ConcreteHandler object on the chain.</p>
                                </div>
                                <div class="text-2xl font-bold text-slate-400">↓</div>
                                <div class="w-full p-4 bg-slate-100 border-2 border-dashed border-slate-300 rounded-lg text-center">
                                    <p class="font-bold font-mono text-slate-700">IHandler (Interface)</p>
                                    <p class="text-sm mt-1 text-slate-600">Defines the interface for handling requests. Optionally implements the successor link.</p>
                                    <div class="mt-2 text-left bg-white p-2 rounded text-xs font-mono border">
                                        + SetNext(handler: IHandler)<br>
                                        + HandleRequest(request: object)
                                    </div>
                                </div>
                                <div class="text-2xl font-bold text-slate-400">↓</div>
                                <div class="w-full grid md:grid-cols-3 gap-4 text-center">
                                    <div class="p-4 bg-teal-50 border border-teal-300 rounded-lg shadow-sm">
                                        <p class="font-bold">ConcreteHandlerA</p>
                                        <p class="text-sm mt-1">Handles requests it's responsible for. Can access its successor.</p>
                                    </div>
                                    <div class="flex items-center justify-center text-xl font-bold text-slate-400">→</div>
                                    <div class="p-4 bg-teal-50 border border-teal-300 rounded-lg shadow-sm">
                                        <p class="font-bold">ConcreteHandlerB</p>
                                        <p class="text-sm mt-1">If it can't handle a request, it passes it to its successor.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ul class="list-disc list-inside space-y-2 mt-4 text-slate-700">
                            <li><strong>Handler:</strong> Defines an interface for handling the requests and (optionally) holds a reference to the next handler in the chain.</li>
                            <li><strong>ConcreteHandler:</strong> Implements the handler interface. It processes requests it's responsible for. If it can't process the request, it passes it to its successor.</li>
                            <li><strong>Client:</strong> Creates the chain of handlers and initiates the request to the first handler in the chain.</li>
                            <li><strong>Request:</strong> An object that contains the data for the request, which is passed along the chain.</li>
                        </ul>
                    </section>

                    <section id="visualization" class="mt-12 space-y-8 scroll-mt-20">
                        <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">Interactive Request Pipeline</h3>
                        <p>This is a core concept in modern web frameworks. A web request for a page might first go through an <strong class="font-semibold">Authentication</strong> check, then a <strong class="font-semibold">Validation</strong> check, and finally a <strong class="font-semibold">Logging</strong> step. Click below to see how a request travels through a middleware pipeline.</p>
                        
                        <div class="bg-white p-6 rounded-xl shadow-md border">
                            <div id="controls" class="flex flex-wrap gap-4 mb-6 pb-6 border-b">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="requestType" value="auth" class="form-radio text-sky-600" checked>
                                    <span class="font-medium">Request needing Authentication</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="requestType" value="cache" class="form-radio text-sky-600">
                                    <span class="font-medium">Request needing Caching</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="requestType" value="logging" class="form-radio text-sky-600">
                                    <span class="font-medium">Request needing Logging</span>
                                </label>
                                <button id="sendRequestBtn" class="bg-sky-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-sky-700 transition-colors">
                                    Send Request
                                </button>
                            </div>
                            
                            <div class="relative">
                                <div id="pipeline" class="flex items-center justify-around p-4 relative">
                                    <div id="node-auth" class="chain-node w-1/4 p-4 border-2 border-slate-300 bg-slate-100 rounded-lg text-center">
                                        <h4 class="font-bold">Auth Handler</h4>
                                        <p class="text-sm">Checks credentials</p>
                                    </div>
                                    <div class="flex-1 h-1 bg-slate-300"></div>
                                    <div id="node-cache" class="chain-node w-1/4 p-4 border-2 border-slate-300 bg-slate-100 rounded-lg text-center">
                                        <h4 class="font-bold">Cache Handler</h4>
                                        <p class="text-sm">Checks for cached data</p>
                                    </div>
                                    <div class="flex-1 h-1 bg-slate-300"></div>
                                    <div id="node-logging" class="chain-node w-1/4 p-4 border-2 border-slate-300 bg-slate-100 rounded-lg text-center">
                                        <h4 class="font-bold">Logging Handler</h4>
                                        <p class="text-sm">Logs the request</p>
                                    </div>
                                </div>
                                <div id="requestDot" class="request-dot"></div>
                            </div>

                            <div id="visualizer-output" class="mt-6 p-4 bg-slate-800 text-white font-mono text-sm rounded-lg min-h-[100px] whitespace-pre-wrap"></div>
                        </div>
                    </section>

                    <section id="coding-practice" class="mt-12 space-y-8 scroll-mt-20">
                        <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">Coding Practice</h3>
                        
                        <div class="space-y-4">
                            <h4 class="text-xl font-bold">Problem 1 [Easy]: Simple Logger Chain</h4>
                            <p>Create a chain of loggers with different levels: INFO, DEBUG, and ERROR. An incoming log message should be handled only by the logger that matches its level or a higher-priority logger if one isn't found. The chain order should be INFO -> DEBUG -> ERROR.</p>
                            <div class="code-block">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code class="language-csharp block bg-slate-800 text-white p-4 rounded-lg overflow-x-auto">
// C# Solution
using System;

public enum LogLevel { INFO, DEBUG, ERROR }

public class LogMessage {
    public LogLevel Level { get; }
    public string Message { get; }
    public LogMessage(LogLevel level, string message) {
        Level = level;
        Message = message;
    }
}

public abstract class Logger {
    protected LogLevel logLevel;
    protected Logger nextLogger;

    public void SetNext(Logger logger) {
        this.nextLogger = logger;
    }

    public void Log(LogMessage logMessage) {
        if (this.logLevel <= logMessage.Level) {
            Write(logMessage);
        }
        nextLogger?.Log(logMessage);
    }
    
    protected abstract void Write(LogMessage logMessage);
}

public class InfoLogger : Logger {
    public InfoLogger() { this.logLevel = LogLevel.INFO; }
    protected override void Write(LogMessage logMessage) {
        Console.WriteLine($"[INFO]: {logMessage.Message}");
    }
}

public class DebugLogger : Logger {
    public DebugLogger() { this.logLevel = LogLevel.DEBUG; }
    protected override void Write(LogMessage logMessage) {
        Console.WriteLine($"[DEBUG]: {logMessage.Message}");
    }
}

public class ErrorLogger : Logger {
    public ErrorLogger() { this.logLevel = LogLevel.ERROR; }
    protected override void Write(LogMessage logMessage) {
        Console.WriteLine($"[ERROR]: {logMessage.Message}");
    }
}

public class Program {
    public static void Main(string[] args) {
        Logger infoLogger = new InfoLogger();
        Logger debugLogger = new DebugLogger();
        Logger errorLogger = new ErrorLogger();

        // Build the chain
        infoLogger.SetNext(debugLogger);
        debugLogger.SetNext(errorLogger);

        Console.WriteLine("--- Sending INFO message ---");
        infoLogger.Log(new LogMessage(LogLevel.INFO, "This is an informational message."));

        Console.WriteLine("\n--- Sending DEBUG message ---");
        infoLogger.Log(new LogMessage(LogLevel.DEBUG, "This is a debug message."));

        Console.WriteLine("\n--- Sending ERROR message ---");
        infoLogger.Log(new LogMessage(LogLevel.ERROR, "This is an error message."));
    }
}

/*
Expected Output:
--- Sending INFO message ---
[INFO]: This is an informational message.
[DEBUG]: This is an informational message.
[ERROR]: This is an informational message.

--- Sending DEBUG message ---
[DEBUG]: This is a debug message.
[ERROR]: This is a debug message.

--- Sending ERROR message ---
[ERROR]: This is an error message.
*/
                                </code></pre>
                            </div>
                        </div>

                    </section>

                    <section id="case-study" class="mt-12 scroll-mt-20">
                        <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">Case Study [Hard]: Request Processing Middleware</h3>
                        <p class="mt-4">Let's design a more robust middleware pipeline for a web server. A request object will be created and passed through a chain of handlers. Each handler can either process the request and stop the chain, modify the request and pass it on, or just pass it on. Our chain will be: Authentication -> Validation -> Caching.</p>
                        
                        <div class="mt-6 bg-white p-6 rounded-xl shadow-md border space-y-4">
                            <h4 class="text-lg font-bold">1. Define the Request and Handlers</h4>
                            <p>We'll need a `Request` class and an abstract `Handler` class.</p>
                             <div class="code-block">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code class="language-csharp block bg-slate-800 text-white p-4 rounded-lg overflow-x-auto">
// C# Solution
using System;
using System.Collections.Generic;

// The request object
public class Request {
    public Dictionary&lt;string, string&gt; Headers { get; } = new Dictionary&lt;string, string&gt;();
    public string Body { get; set; }
    public bool IsHandled { get; set; } = false;
}

// The abstract Handler
public abstract class Handler {
    protected Handler next;
    
    public void SetNext(Handler handler) {
        this.next = handler;
    }

    public abstract void Handle(Request request);
}
                                </code></pre>
                            </div>

                            <h4 class="text-lg font-bold mt-4">2. Implement Concrete Handlers</h4>
                            <p>Each handler performs a specific task. Note how the `AuthenticationHandler` can stop the chain if auth fails.</p>
                            <div class="code-block">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code class="language-csharp block bg-slate-800 text-white p-4 rounded-lg overflow-x-auto">
public class AuthenticationHandler : Handler {
    public override void Handle(Request request) {
        Console.WriteLine("Authentication: Checking for auth token...");
        if (!request.Headers.ContainsKey("AuthToken") || request.Headers["AuthToken"] != "valid-token") {
            Console.WriteLine("Authentication: FAILED! Request blocked.");
            request.IsHandled = true; // Stop the chain
            return;
        }
        Console.WriteLine("Authentication: Passed.");
        next?.Handle(request);
    }
}

public class ValidationHandler : Handler {
    public override void Handle(Request request) {
        Console.WriteLine("Validation: Checking request body...");
        if (string.IsNullOrEmpty(request.Body)) {
            Console.WriteLine("Validation: FAILED! Body is empty. Request blocked.");
            request.IsHandled = true; // Stop the chain
            return;
        }
        Console.WriteLine("Validation: Passed.");
        next?.Handle(request);
    }
}

public class CachingHandler : Handler {
    private Dictionary&lt;string, string&gt; cache = new Dictionary&lt;string, string&gt;();
    
    public CachingHandler(){
        cache["some-key"] = "Cached data for some-key";
    }

    public override void Handle(Request request) {
        Console.WriteLine("Caching: Checking cache...");
        if (cache.ContainsKey(request.Body)) {
            Console.WriteLine($"Caching: HIT! Returning cached data for '{request.Body}'.");
            request.IsHandled = true; // Stop the chain, data found
            return;
        }
        Console.WriteLine("Caching: MISS. Passing to next handler.");
        next?.Handle(request);
    }
}

public class FinalHandler : Handler {
     public override void Handle(Request request) {
        Console.WriteLine("Final Handler: Processing the request from scratch...");
        Console.WriteLine("Final Handler: Request processed successfully.");
        request.IsHandled = true;
     }
}
                                </code></pre>
                            </div>

                             <h4 class="text-lg font-bold mt-4">3. Build and Run the Chain</h4>
                             <div class="code-block">
                                <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                <pre><code class="language-csharp block bg-slate-800 text-white p-4 rounded-lg overflow-x-auto">
public class MiddlewareExample {
    public static void Main(string[] args) {
        // Build the chain
        var auth = new AuthenticationHandler();
        var validation = new ValidationHandler();
        var cache = new CachingHandler();
        var final = new FinalHandler();

        auth.SetNext(validation);
        validation.SetNext(cache);
        cache.SetNext(final);

        Console.WriteLine("--- Scenario 1: Valid request, cache miss ---");
        var request1 = new Request { Body = "new-data" };
        request1.Headers.Add("AuthToken", "valid-token");
        auth.Handle(request1);

        Console.WriteLine("\n--- Scenario 2: Valid request, cache hit ---");
        var request2 = new Request { Body = "some-key" };
        request2.Headers.Add("AuthToken", "valid-token");
        auth.Handle(request2);

        Console.WriteLine("\n--- Scenario 3: Invalid auth token ---");
        var request3 = new Request { Body = "some-data" };
        request3.Headers.Add("AuthToken", "invalid-token");
        auth.Handle(request3);
        
        Console.WriteLine("\n--- Scenario 4: Empty body ---");
        var request4 = new Request { Body = "" };
        request4.Headers.Add("AuthToken", "valid-token");
        auth.Handle(request4);
    }
}

/*
Expected Output:
--- Scenario 1: Valid request, cache miss ---
Authentication: Checking for auth token...
Authentication: Passed.
Validation: Checking request body...
Validation: Passed.
Caching: Checking cache...
Caching: MISS. Passing to next handler.
Final Handler: Processing the request from scratch...
Final Handler: Request processed successfully.

--- Scenario 2: Valid request, cache hit ---
Authentication: Checking for auth token...
Authentication: Passed.
Validation: Checking request body...
Validation: Passed.
Caching: Checking cache...
Caching: HIT! Returning cached data for 'some-key'.

--- Scenario 3: Invalid auth token ---
Authentication: Checking for auth token...
Authentication: FAILED! Request blocked.

--- Scenario 4: Empty body ---
Authentication: Checking for auth token...
Authentication: Passed.
Validation: Checking request body...
Validation: FAILED! Body is empty. Request blocked.
*/
                                </code></pre>
                            </div>
                        </div>
                    </section>
                    
                    <section id="knowledge-check" class="mt-12 scroll-mt-20">
                        <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">Knowledge Check</h3>
                        <form id="quiz-form" class="mt-6 space-y-8 bg-white p-6 rounded-xl shadow-md border">
                            <div class="quiz-question">
                                <p class="font-semibold">1. What is the primary intent of the Chain of Responsibility pattern?</p>
                                <div class="mt-2 space-y-2">
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q1" value="a" class="form-radio text-sky-600 mr-3">
                                        <span>To ensure every request is handled by exactly one object.</span>
                                    </label>
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q1" value="b" class="form-radio text-sky-600 mr-3">
                                        <span>To decouple the sender of a request from its receiver.</span>
                                    </label>
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q1" value="c" class="form-radio text-sky-600 mr-3">
                                        <span>To create a complex tree-like structure of command objects.</span>
                                    </label>
                                </div>
                            </div>
                            <div class="quiz-question">
                                <p class="font-semibold">2. In a typical implementation, what happens if a ConcreteHandler cannot process a request?</p>
                                <div class="mt-2 space-y-2">
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q2" value="a" class="form-radio text-sky-600 mr-3">
                                        <span>It throws an exception.</span>
                                    </label>
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q2" value="b" class="form-radio text-sky-600 mr-3">
                                        <span>It returns a null value to the client.</span>
                                    </label>
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q2" value="c" class="form-radio text-sky-600 mr-3">
                                        <span>It passes the request to the next handler in the chain.</span>
                                    </label>
                                </div>
                            </div>
                             <div class="quiz-question">
                                <p class="font-semibold">3. A key benefit of this pattern is that the chain of handlers can often be configured...</p>
                                <div class="mt-2 space-y-2">
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q3" value="a" class="form-radio text-sky-600 mr-3">
                                        <span>Only at compile time.</span>
                                    </label>
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q3" value="b" class="form-radio text-sky-600 mr-3">
                                        <span>Dynamically at runtime.</span>
                                    </label>
                                    <label class="quiz-option flex items-center p-3 border rounded-lg hover:bg-slate-50 cursor-pointer transition-colors">
                                        <input type="radio" name="q3" value="c" class="form-radio text-sky-600 mr-3">
                                        <span>Only once when the application starts.</span>
                                    </label>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <button type="submit" class="bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-700 transition-colors">Check Answers</button>
                                <p id="quiz-result" class="font-bold text-lg"></p>
                            </div>
                        </form>
                    </section>
                    
                    <section id="self-assessment" class="mt-12 scroll-mt-20">
                         <h3 class="text-3xl font-bold font-lexend tracking-tight border-b pb-2">Self-Assessment Challenge</h3>
                         <div class="mt-6 bg-white p-6 rounded-xl shadow-md border space-y-4">
                            <p class="font-semibold">Your Challenge: Document Approval Workflow</p>
                            <p>Design a document approval system. A `Document` object needs to be approved by several roles in a specific order: <strong class="font-semibold">Team Lead</strong>, then <strong class="font-semibold">Manager</strong>, then <strong class="font-semibold">Director</strong>. Each approver can only approve documents up to a certain "sensitivity level" (an integer value).</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Team Lead can approve documents with sensitivity <= 10.</li>
                                <li>Manager can approve documents with sensitivity <= 20.</li>
                                <li>Director can approve any document.</li>
                            </ul>
                            <p>If an approver cannot handle the sensitivity level, they must pass it to their superior. If a document is approved, the chain stops. Create the classes and demonstrate the workflow with documents of sensitivity 5, 15, and 25.</p>
                            <button id="toggle-solution-btn" class="mt-4 bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">
                                Show Solution
                            </button>
                            <div id="solution-div" class="hidden mt-4">
                                <div class="code-block">
                                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                                    <pre><code class="language-csharp block bg-slate-800 text-white p-4 rounded-lg overflow-x-auto">
// C# Solution
using System;

public class Document {
    public int Sensitivity { get; }
    public string Content { get; }
    public Document(string content, int sensitivity) {
        Content = content;
        Sensitivity = sensitivity;
    }
}

public abstract class Approver {
    protected Approver successor;
    protected string roleName;
    
    public void SetSuccessor(Approver successor) {
        this.successor = successor;
    }
    
    public abstract void ProcessRequest(Document document);
}

public class TeamLead : Approver {
    public TeamLead() { this.roleName = "Team Lead"; }
    public override void ProcessRequest(Document document) {
        if (document.Sensitivity <= 10) {
            Console.WriteLine($"{roleName} approved document: '{document.Content}'");
        } else if (successor != null) {
            Console.WriteLine($"{roleName} cannot approve. Escalating...");
            successor.ProcessRequest(document);
        }
    }
}

public class Manager : Approver {
    public Manager() { this.roleName = "Manager"; }
    public override void ProcessRequest(Document document) {
        if (document.Sensitivity <= 20) {
            Console.WriteLine($"{roleName} approved document: '{document.Content}'");
        } else if (successor != null) {
            Console.WriteLine($"{roleName} cannot approve. Escalating...");
            successor.ProcessRequest(document);
        }
    }
}

public class Director : Approver {
    public Director() { this.roleName = "Director"; }
    public override void ProcessRequest(Document document) {
        // Director can approve anything
        Console.WriteLine($"{roleName} approved document: '{document.Content}'");
    }
}

public class ApprovalWorkflow {
    public static void Main(string[] args) {
        // Setup the chain
        Approver lead = new TeamLead();
        Approver manager = new Manager();
        Approver director = new Director();

        lead.SetSuccessor(manager);
        manager.SetSuccessor(director);

        // Process documents
        Console.WriteLine("--- Processing Document 1 (Sensitivity 5) ---");
        lead.ProcessRequest(new Document("Q3 Expense Report", 5));
        
        Console.WriteLine("\n--- Processing Document 2 (Sensitivity 15) ---");
        lead.ProcessRequest(new Document("Project Alpha Budget", 15));

        Console.WriteLine("\n--- Processing Document 3 (Sensitivity 25) ---");
        lead.ProcessRequest(new Document("Acquisition Proposal", 25));
    }
}

/* Expected Output:
--- Processing Document 1 (Sensitivity 5) ---
Team Lead approved document: 'Q3 Expense Report'

--- Processing Document 2 (Sensitivity 15) ---
Team Lead cannot approve. Escalating...
Manager approved document: 'Project Alpha Budget'

--- Processing Document 3 (Sensitivity 25) ---
Team Lead cannot approve. Escalating...
Manager cannot approve. Escalating...
Director approved document: 'Acquisition Proposal'
*/
                                    </code></pre>
                                </div>
                            </div>
                         </div>
                    </section>
                </article>
            </div>
            
            <aside class="hidden lg:block lg:w-1/4">
                <nav id="toc" class="sticky top-24">
                    <h3 class="font-lexend font-bold text-lg">On This Page</h3>
                    <ul class="mt-4 space-y-2 text-slate-600">
                        <li><a href="#intro" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Introduction</a></li>
                        <li><a href="#theory" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Theory & Concepts</a></li>
                        <li><a href="#uml" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">UML Diagram</a></li>
                        <li><a href="#visualization" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Interactive Pipeline</a></li>
                        <li><a href="#coding-practice" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Coding Practice</a></li>
                        <li><a href="#case-study" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Case Study</a></li>
                        <li><a href="#knowledge-check" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Knowledge Check</a></li>
                        <li><a href="#self-assessment" class="toc-link block border-l-2 border-slate-200 pl-4 py-1 hover:text-sky-600 hover:border-sky-600 transition-colors">Self-Assessment</a></li>
                    </ul>
                </nav>
            </aside>
            
        </div>
    </main>

    <footer class="text-center mt-16 py-8 border-t border-slate-200">
        <p class="text-slate-700 font-semibold">Low-Level Design Bootcamp</p>
        <p class="text-sm text-slate-500 mt-2">A personalized learning roadmap curated by Mr. Mahesh Singare.</p>
        <p class="text-xs text-slate-400 mt-4">&copy; 2025. All Rights Reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // TOC Scroll Spy
        const sections = document.querySelectorAll('section[id]');
        const tocLinks = document.querySelectorAll('.toc-link');

        const observerOptions = {
            rootMargin: '-50px 0px -50% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                const tocLink = document.querySelector(`.toc-link[href="#${id}"]`);
                if (entry.isIntersecting) {
                    tocLinks.forEach(link => link.classList.remove('active'));
                    if (tocLink) {
                        tocLink.classList.add('active');
                    }
                }
            });
        }, observerOptions);

        sections.forEach(section => observer.observe(section));
        
        // Copy to clipboard
        window.copyCode = function(button) {
            const pre = button.parentElement.querySelector('pre > code');
            const text = pre.innerText;
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => {
                    button.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        // Quiz Logic
        const quizForm = document.getElementById('quiz-form');
        const quizResult = document.getElementById('quiz-result');
        const correctAnswers = { q1: 'b', q2: 'c', q3: 'b' };

        quizForm.addEventListener('submit', e => {
            e.preventDefault();
            let score = 0;
            const totalQuestions = Object.keys(correctAnswers).length;
            
            for (const [question, answer] of Object.entries(correctAnswers)) {
                const selected = quizForm.querySelector(`input[name="${question}"]:checked`);
                const options = quizForm.querySelectorAll(`input[name="${question}"]`);
                
                options.forEach(opt => {
                    const label = opt.closest('.quiz-option');
                    label.classList.remove('correct', 'incorrect');
                });

                if (selected) {
                    const selectedLabel = selected.closest('.quiz-option');
                    if (selected.value === answer) {
                        score++;
                        selectedLabel.classList.add('correct');
                    } else {
                        selectedLabel.classList.add('incorrect');
                        // Also show the correct one
                        const correctOption = quizForm.querySelector(`input[name="${question}"][value="${answer}"]`);
                        if(correctOption) correctOption.closest('.quiz-option').classList.add('correct');
                    }
                }
            }
            quizResult.textContent = `You scored ${score} out of ${totalQuestions}!`;
        });

        // Self-Assessment Solution Toggle
        const toggleBtn = document.getElementById('toggle-solution-btn');
        const solutionDiv = document.getElementById('solution-div');
        toggleBtn.addEventListener('click', () => {
            const isHidden = solutionDiv.classList.contains('hidden');
            solutionDiv.classList.toggle('hidden');
            toggleBtn.textContent = isHidden ? 'Hide Solution' : 'Show Solution';
        });

        // Interactive Visualization
        const sendRequestBtn = document.getElementById('sendRequestBtn');
        const outputDiv = document.getElementById('visualizer-output');
        const requestDot = document.getElementById('requestDot');
        const nodes = {
            auth: document.getElementById('node-auth'),
            cache: document.getElementById('node-cache'),
            logging: document.getElementById('node-logging')
        };
        let isAnimating = false;

        sendRequestBtn.addEventListener('click', () => {
            if (isAnimating) return;
            isAnimating = true;
            
            const requestType = document.querySelector('input[name="requestType"]:checked').value;
            outputDiv.innerHTML = '';
            Object.values(nodes).forEach(node => node.classList.remove('active'));

            const pipeline = ['auth', 'cache', 'logging'];
            
            const processStep = (stepIndex) => {
                if (stepIndex >= pipeline.length) {
                    outputDiv.innerHTML += `> Request processed successfully.\n`;
                    isAnimating = false;
                    return;
                }

                const currentStep = pipeline[stepIndex];
                const currentNode = nodes[currentStep];

                // Animate dot to current node
                const nodeRect = currentNode.getBoundingClientRect();
                const pipelineRect = document.getElementById('pipeline').getBoundingClientRect();
                requestDot.style.opacity = '1';
                requestDot.style.top = `${nodeRect.top - pipelineRect.top + (nodeRect.height / 2) - 10}px`;
                requestDot.style.left = `${nodeRect.left - pipelineRect.left + (nodeRect.width / 2) - 10}px`;

                setTimeout(() => {
                    currentNode.classList.add('active');
                    outputDiv.innerHTML += `> Entering ${currentStep.charAt(0).toUpperCase() + currentStep.slice(1)} Handler...\n`;

                    setTimeout(() => {
                        let handled = false;
                        if (currentStep === requestType) {
                            outputDiv.innerHTML += `> Request handled by ${currentStep.charAt(0).toUpperCase() + currentStep.slice(1)} Handler. Chain stopped.\n`;
                            handled = true;
                        } else {
                            outputDiv.innerHTML += `> Request not for this handler. Passing on...\n`;
                        }

                        currentNode.classList.remove('active');
                        
                        if (handled) {
                            setTimeout(() => requestDot.style.opacity = '0', 500);
                            isAnimating = false;
                        } else {
                            processStep(stepIndex + 1);
                        }

                    }, 1000);
                }, 500);
            };
            
            processStep(0);
        });
    });
    </script>
</body>
</html>
