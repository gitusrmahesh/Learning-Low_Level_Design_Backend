<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 29: Factory Pattern - LLD Bootcamp</title>
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: The application is designed as a single, scrollable lesson page for an immersive learning experience. A two-column layout is used: the main content area on the left provides a linear, top-down flow from theory to practice, which is the most intuitive structure for a study guide. A sticky Table of Contents (TOC) on the right allows for non-linear navigation, letting users jump to specific sections of interest. Interactivity is introduced through copy-to-clipboard buttons for code, an interactive quiz for knowledge checks, and a revealable solution for the final challenge, reinforcing learning through active engagement rather than passive reading. This structure was chosen to blend guided learning with self-paced exploration effectively. -->
    <!-- Visualization & Content Choices: Report Info: UML diagrams, pattern comparisons, coding examples. -> Goal: Clarify complex relationships and provide practical implementation details. -> Viz/Presentation Method: UML diagrams are built with structured HTML and Tailwind CSS to avoid external images or complex libraries. Comparisons are presented in clear, styled tables. Code is displayed in syntax-highlighted blocks. -> Interaction: Users can copy code snippets with a single click. Quizzes provide immediate feedback. -> Justification: These choices prioritize clarity, accessibility, and active learning. Using HTML/CSS for diagrams ensures the page is self-contained and fast-loading. Interactive code blocks and quizzes make the learning process more efficient and engaging. -> Library/Method: Vanilla JavaScript for all interactions (TOC, copy, quiz). No Chart.js/Plotly as there's no quantitative data to display. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800&family=Source+Code+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Lexend', sans-serif;
            background-color: #f8f7f4;
            color: #3f3c3a;
        }
        h1, h2, h3, h4 {
            font-family: 'Lexend', sans-serif;
        }
        pre {
            font-family: 'Source Code Pro', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .code-block {
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            padding: 0.3rem 0.6rem;
            background-color: #e0e0e0;
            color: #3f3c3a;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #c7c7c7;
        }
        .toc-link.active {
            color: #c78d4e;
            font-weight: 600;
            transform: translateX(4px);
        }
        .prose h2 { margin-top: 2.5em; margin-bottom: 1em; }
        .prose h3 { margin-top: 2em; margin-bottom: 0.8em; }
        .quiz-option.correct {
            background-color: #d1fae5;
            border-color: #10b981;
        }
        .quiz-option.incorrect {
            background-color: #fee2e2;
            border-color: #ef4444;
        }
    </style>
</head>
<body class="bg-[#f8f7f4]">

    <div class="bg-slate-100/80 border-b border-slate-200">
        <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 relative">
            <header class="text-center">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-800 mt-1 tracking-tight font-lexend">Low-Level Design Bootcamp</h1>
                <p class="mt-3 text-slate-600 max-w-xl mx-auto">Your 60-Day Interactive Roadmap to Mastering Backend Engineering.</p>
            </header>
            <a href="roadmap.html" class="absolute top-1/2 -translate-y-1/2 right-4 sm:right-6 lg:right-8 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">
                Return to Homepage
            </a>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="flex flex-col lg:flex-row lg:space-x-12">

            <main class="w-full lg:w-3/4 prose prose-slate max-w-none prose-h2:text-3xl prose-h2:font-bold prose-h2:border-b prose-h2:border-slate-200 prose-h2:pb-4 prose-h3:text-2xl prose-h3:font-semibold">
                <div class="mb-8">
                    <p class="text-sm font-semibold text-[#c78d4e] uppercase">Week 5: Creational Design Patterns</p>
                    <h1 class="text-5xl font-extrabold text-slate-800 tracking-tight">Day 29: Factory Pattern</h1>
                    <p class="text-xl text-slate-600 mt-4">Learn how to decouple object creation from client code, making your application more flexible and easier to maintain.</p>
                </div>

                <section id="theory">
                    <h2 id="theory-intro">âœ… Theory Topics</h2>
                    <p>Before we dive into the Factory Pattern, it's crucial to understand the landscape of design patterns. They are not specific algorithms but high-level blueprints for solving recurring design problems in software development. They provide a common language and proven solutions that can speed up development and improve code quality.</p>

                    <h3 id="theory-types">Different Types of Design Patterns</h3>
                    <p>Design patterns are generally categorized into three main groups based on their purpose:</p>
                    <ul class="list-disc pl-5 space-y-2">
                        <li><strong>Creational Patterns:</strong> These patterns focus on object creation mechanisms, trying to create objects in a manner suitable to the situation. They increase flexibility and reuse of existing code. Examples include Singleton, Factory, Abstract Factory, Builder, and Prototype.</li>
                        <li><strong>Structural Patterns:</strong> These patterns deal with object composition. They explain how to assemble objects and classes into larger structures while keeping these structures flexible and efficient. Examples include Adapter, Decorator, Facade, and Proxy.</li>
                        <li><strong>Behavioral Patterns:</strong> These patterns are concerned with algorithms and the assignment of responsibilities between objects. They describe patterns of communication between objects. Examples include Observer, Strategy, Command, and Template Method.</li>
                    </ul>

                    <h3 id="theory-what-is">What is the Factory Pattern?</h3>
                    <p>The Factory Pattern is a creational design pattern that provides an interface for creating objects in a superclass, but allows subclasses to alter the type of objects that will be created. It's often called the "Virtual Constructor".</p>
                    <div class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg my-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fa-solid fa-lightbulb text-amber-500 text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-amber-700"><strong>Analogy: A Pizza Restaurant</strong></p>
                                <p class="text-sm text-amber-700 mt-1">Imagine you're running a pizza franchise. You have a central `PizzaStore` class that knows how to prepare, bake, and box a pizza. However, different regions have different popular pizzas (e.g., NYStyleCheesePizza, ChicagoStyleDeepDish). Instead of having the `PizzaStore` know about every type of pizza, you define a `createPizza()` method. Each regional franchise (e.g., `NYPizzaStore`, `ChicagoPizzaStore`) implements this method to create the specific pizza type for their region. The main `PizzaStore` logic doesn't change, it just calls the `createPizza()` method provided by its subclass.</p>
                            </div>
                        </div>
                    </div>
                    <p>The key idea is to replace direct object construction calls (using the `new` operator) with calls to a special "factory" method. The objects are still created via the `new` operator, but itâ€™s being called from within the factory method. This encapsulates the creation logic and decouples the client code from the concrete classes it needs to instantiate.</p>

                    <h3 id="theory-factory-vs-abstract">Difference between Factory and Abstract Factory</h3>
                    <p>These two patterns are often confused due to their similar names and purpose. The main difference lies in their scope and intent.</p>
                    <table class="w-full my-6 border border-slate-300 rounded-lg shadow-sm">
                        <thead class="bg-slate-100">
                            <tr>
                                <th class="p-3 text-left font-semibold">Aspect</th>
                                <th class="p-3 text-left font-semibold">Factory Pattern</th>
                                <th class="p-3 text-left font-semibold">Abstract Factory Pattern</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr class="bg-white">
                                <td class="p-3 font-medium">Purpose</td>
                                <td class="p-3">Creates one specific product from a family of products. Focuses on a single creation method.</td>
                                <td class="p-3">Creates families of related or dependent objects. Often called a "factory of factories".</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="p-3 font-medium">Implementation</td>
                                <td class="p-3">Typically uses one factory method in a creator class, often overridden by subclasses.</td>
                                <td class="p-3">Uses an interface with multiple factory methods, one for each product in the family.</td>
                            </tr>
                            <tr class="bg-white">
                                <td class="p-3 font-medium">Hierarchy</td>
                                <td class="p-3">Creation is done in a method exposed by a subclass.</td>
                                <td class="p-3">Creation is done in methods exposed by a concrete factory class that implements the abstract factory interface.</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="p-3 font-medium">Analogy</td>
                                <td class="p-3">A single machine that produces different types of screws (flathead, Phillips) based on a setting.</td>
                                <td class="p-3">A furniture factory that produces matching sets (e.g., a Victorian set with a Victorian chair, table, and sofa).</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 id="theory-when-to-use">When to use Factory in the backend.</h3>
                    <p>The Factory pattern is extremely useful in backend development for promoting loose coupling and adhering to the SOLID principles, particularly the Dependency Inversion Principle.</p>
                    <ul class="list-disc pl-5 space-y-2">
                        <li><strong>When you don't know the exact types of objects your code will work with beforehand.</strong> The factory encapsulates the logic for choosing which class to instantiate.</li>
                        <li><strong>When you want to provide users of your library or framework a way to extend its internal components.</strong> For example, a logging framework might allow users to define their own custom loggers (e.g., `FileLogger`, `DatabaseLogger`, `ConsoleLogger`).</li>
                        <li><strong>When you want to save system resources by reusing objects instead of rebuilding them each time.</strong> This is common for expensive objects like database connections or thread pools. The factory can return an existing instance from a pool.</li>
                    </ul>

                    <h3 id="theory-avoiding-switch">Avoiding switch-case for object creation</h3>
                    <p>A common anti-pattern is using a large `switch` or `if-else-if` block to decide which object to create. This violates the Open/Closed Principle because adding a new product type requires modifying this central block of code.</p>
                    
                    <div class="code-block my-6">
                        <button class="copy-button" title="Copy to clipboard">
                            <i class="fa-regular fa-copy"></i> Copy
                        </button>
                        <pre class="bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto"><code class="language-csharp">// BAD: Violates Open/Closed Principle
public class BadPaymentProcessorFactory
{
    public IPaymentProcessor GetProcessor(string type)
    {
        switch (type)
        {
            case "Stripe":
                return new StripeProcessor();
            case "PayPal":
                return new PayPalProcessor();
            // What if we need to add Razorpay? We have to modify this file!
            default:
                throw new NotSupportedException("Payment type not supported");
        }
    }
}</code></pre>
                    </div>

                    <p>A better approach is to use polymorphism or a dictionary/map that can be configured at runtime. The Factory Pattern provides a structured way to manage this, often by delegating the creation choice to subclasses or by using reflection to dynamically load and instantiate types.</p>
                </section>

                <section id="coding-practice">
                    <h2 id="coding-intro">âœ… Coding Practice (C#)</h2>
                    <p>Let's solidify our understanding with some practical C# examples, ranging from simple to complex.</p>

                    <h3 id="coding-easy">[Easy] ShapeFactory</h3>
                    <p>This is a classic "Hello, World!" example for the Factory Pattern. We want to create different shapes without the client code needing to know the concrete shape classes.</p>
                    <div class="code-block my-6">
                        <button class="copy-button" title="Copy to clipboard">
                            <i class="fa-regular fa-copy"></i> Copy
                        </button>
                        <pre class="bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto"><code class="language-csharp">
// 1. Product Interface
public interface IShape
{
    void Draw();
}

// 2. Concrete Products
public class Circle : IShape
{
    public void Draw() => Console.WriteLine("Drawing a Circle.");
}

public class Square : IShape
{
    public void Draw() => Console.WriteLine("Drawing a Square.");
}

// 3. The Factory
public class ShapeFactory
{
    public IShape GetShape(string shapeType)
    {
        return shapeType.ToLower() switch
        {
            "circle" => new Circle(),
            "square" => new Square(),
            _ => throw new ArgumentException("Invalid shape type"),
        };
    }
}

// 4. Client Code
public class Client
{
    public void Main()
    {
        ShapeFactory factory = new ShapeFactory();
        
        IShape shape1 = factory.GetShape("circle");
        shape1.Draw(); // Output: Drawing a Circle.
        
        IShape shape2 = factory.GetShape("square");
        shape2.Draw(); // Output: Drawing a Square.
    }
}
</code></pre>
                    </div>

                    <h3 id="coding-medium">[Medium] LoggerFactory</h3>
                    <p>In this scenario, we want to create different types of loggers. The application might decide which logger to use based on a configuration file, without the business logic needing to know the details.</p>
                     <div class="code-block my-6">
                        <button class="copy-button" title="Copy to clipboard">
                            <i class="fa-regular fa-copy"></i> Copy
                        </button>
                        <pre class="bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto"><code class="language-csharp">
// 1. Product Interface
public interface ILogger
{
    void Log(string message);
}

// 2. Concrete Products
public class FileLogger : ILogger
{
    private readonly string _path;
    public FileLogger(string path) => _path = path;
    public void Log(string message) => File.AppendAllText(_path, message + Environment.NewLine);
}

public class ConsoleLogger : ILogger
{
    public void Log(string message) => Console.WriteLine(message);
}

// 3. Creator (Abstract Factory)
public abstract class LoggerFactory
{
    public abstract ILogger CreateLogger();

    public void LogMessage(string message)
    {
        ILogger logger = CreateLogger();
        logger.Log($"[{DateTime.Now:G}]: {message}");
    }
}

// 4. Concrete Creators
public class FileLoggerFactory : LoggerFactory
{
    private readonly string _filePath;
    public FileLoggerFactory(string filePath) => _filePath = filePath;
    public override ILogger CreateLogger() => new FileLogger(_filePath);
}

public class ConsoleLoggerFactory : LoggerFactory
{
    public override ILogger CreateLogger() => new ConsoleLogger();
}

// 5. Client Code
public class AppConfig
{
    public static LoggerFactory GetLoggerFactory()
    {
        // In a real app, this would read from a config file (e.g., appsettings.json)
        string logTarget = "console"; 
        
        if (logTarget == "file")
        {
            return new FileLoggerFactory("app.log");
        }
        return new ConsoleLoggerFactory();
    }
}

public class Client
{
    public void Main()
    {
        LoggerFactory factory = AppConfig.GetLoggerFactory();
        factory.LogMessage("Application has started.");
    }
}
</code></pre>
                    </div>

                    <h3 id="coding-hard">[Hard] Database Connection Factory</h3>
                    <p>Creating database connections can be resource-intensive. A factory can manage this, potentially incorporating a connection pool to reuse connections. This example uses a simplified factory for different DB providers.</p>
                     <div class="code-block my-6">
                        <button class="copy-button" title="Copy to clipboard">
                            <i class="fa-regular fa-copy"></i> Copy
                        </button>
                        <pre class="bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto"><code class="language-csharp">
using System.Data;
using System.Data.SqlClient; // For SQL Server
// using MySql.Data.MySqlClient; // For MySQL - requires package
// using Npgsql; // For PostgreSQL - requires package

// 1. Product is the IDbConnection interface from System.Data
// 2. Concrete Products are SqlConnection, MySqlConnection etc.

// 3. The Factory
public enum DatabaseType { SqlServer, MySql, PostgreSql }

public static class DbConnectionFactory
{
    private static readonly Dictionary&lt;DatabaseType, Func&lt;string, IDbConnection>> _providers = new();

    // Static constructor to register providers
    static DbConnectionFactory()
    {
        // This is a more extensible way than a switch-case
        RegisterProvider(DatabaseType.SqlServer, connectionString => new SqlConnection(connectionString));
        // RegisterProvider(DatabaseType.MySql, connectionString => new MySqlConnection(connectionString));
        // RegisterProvider(DatabaseType.PostgreSql, connectionString => new NpgsqlConnection(connectionString));
    }
    
    public static void RegisterProvider(DatabaseType type, Func&lt;string, IDbConnection> factoryMethod)
    {
        _providers[type] = factoryMethod;
    }

    public static IDbConnection CreateConnection(DatabaseType type, string connectionString)
    {
        if (_providers.TryGetValue(type, out var factoryMethod))
        {
            return factoryMethod(connectionString);
        }
        throw new NotSupportedException($"Database type '{type}' is not supported.");
    }
}

// 4. Client Code
public class Client
{
    public void Main()
    {
        string sqlConnectionString = "Server=myServerAddress;Database=myDataBase;User Id=myUsername;Password=myPassword;";
        
        try
        {
            // The client only knows about the factory and the enum, not the concrete SqlConnection class.
            using IDbConnection connection = DbConnectionFactory.CreateConnection(DatabaseType.SqlServer, sqlConnectionString);
            connection.Open();
            Console.WriteLine($"Connection to {connection.Database} is {connection.State}");
            // Perform database operations...
            connection.Close();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An error occurred: {ex.Message}");
        }
    }
}
</code></pre>
                    </div>
                </section>

                <section id="uml-task">
                    <h2 id="uml-intro">âœ… UML/Schema Task</h2>
                    <h3 id="uml-diagram">UML for the Factory Pattern</h3>
                    <p>The UML diagram for the Factory Method pattern clearly illustrates the relationships between the creator and product hierarchies.</p>
                    <div class="my-8 p-6 bg-slate-50 border border-slate-200 rounded-lg">
                        <p class="text-center text-lg font-semibold mb-4">Factory Method UML Diagram</p>
                        <div class="flex flex-col space-y-4 md:space-y-0 md:flex-row md:space-x-4 justify-center items-center text-center text-sm">
                            <!-- Creator Side -->
                            <div class="w-full md:w-1/2 space-y-4">
                                <div class="p-4 bg-white border-2 border-slate-400 rounded-md shadow-md">
                                    <p class="font-bold">&lt;&lt;abstract&gt;&gt;<br>Creator</p>
                                    <hr class="my-2">
                                    <p class="text-left italic">+ FactoryMethod(): Product</p>
                                    <p class="text-left">+ AnOperation()</p>
                                </div>
                                <div class="text-2xl font-mono text-slate-500 transform rotate-90 md:rotate-0">&#8679;</div>
                                <div class="p-4 bg-white border border-slate-400 rounded-md shadow-sm">
                                    <p class="font-bold">ConcreteCreator</p>
                                    <hr class="my-2">
                                    <p class="text-left italic">+ FactoryMethod(): Product</p>
                                </div>
                            </div>
                            <!-- Product Side -->
                            <div class="w-full md:w-1/2 space-y-4">
                                <div class="p-4 bg-white border-2 border-slate-400 rounded-md shadow-md">
                                    <p class="font-bold">&lt;&lt;interface&gt;&gt;<br>Product</p>
                                </div>
                                <div class="text-2xl font-mono text-slate-500 transform rotate-90 md:rotate-0">&#8679;</div>
                                <div class="p-4 bg-white border border-slate-400 rounded-md shadow-sm">
                                    <p class="font-bold">ConcreteProduct</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-xs text-center text-slate-500">
                           <p>The <span class="font-mono">Creator</span>'s <span class="font-mono">AnOperation()</span> method calls the <span class="font-mono">FactoryMethod()</span> to get a <span class="font-mono">Product</span> object, on which it then performs work. The <span class="font-mono">ConcreteCreator</span> overrides the <span class="font-mono">FactoryMethod()</span> to return a specific <span class="font-mono">ConcreteProduct</span>.</p>
                        </div>
                    </div>
                </section>
                
                <section id="case-study">
                    <h2 id="case-study-intro">âœ… Case Study / Machine Coding Exercise</h2>
                    <h3 id="case-study-payment">Factory for Payment Gateways (PayPal, Stripe, Razorpay)</h3>
                    <p><strong>Problem:</strong> An e-commerce application needs to process payments through various gateways. The application should be able to switch between gateways or add new ones with minimal changes to the core payment processing logic.</p>
                    <p><strong>Analysis:</strong> This is a perfect scenario for the Factory Pattern. The client code (e.g., an `OrderService`) needs a payment processor, but it shouldn't be tightly coupled to `StripeProcessor` or `PayPalProcessor`. We can create a `PaymentGatewayFactory` that encapsulates the logic of which processor to instantiate based on user choice or configuration.</p>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg my-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fa-solid fa-gears text-blue-500 text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-800"><strong>Design Steps:</strong></p>
                                <ol class="list-decimal pl-4 mt-1 text-sm text-blue-700 space-y-1">
                                    <li>Define an `IPaymentGateway` interface with a `ProcessPayment(decimal amount)` method.</li>
                                    <li>Create concrete classes like `StripeGateway`, `PayPalGateway`, and `RazorpayGateway` that implement the interface.</li>
                                    <li>Create a `PaymentGatewayFactory` with a method `CreateGateway(string gatewayName)` that returns an instance of `IPaymentGateway`.</li>
                                    <li>The client code will use the factory to get a gateway object and then call its `ProcessPayment` method.</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <h4 class="text-xl font-semibold mt-6">Complete C# Implementation:</h4>
                    <div class="code-block my-6">
                        <button class="copy-button" title="Copy to clipboard">
                            <i class="fa-regular fa-copy"></i> Copy
                        </button>
                        <pre class="bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto"><code class="language-csharp">
// 1. Product Interface
public interface IPaymentGateway
{
    string Name { get; }
    void ProcessPayment(decimal amount);
}

// 2. Concrete Products
public class StripeGateway : IPaymentGateway
{
    public string Name => "Stripe";
    public void ProcessPayment(decimal amount)
    {
        Console.WriteLine($"Processing payment of ${amount} through Stripe.");
        // Logic to call Stripe API would go here
    }
}

public class PayPalGateway : IPaymentGateway
{
    public string Name => "PayPal";
    public void ProcessPayment(decimal amount)
    {
        Console.WriteLine($"Processing payment of ${amount} through PayPal.");
        // Logic to call PayPal API
    }
}

public class RazorpayGateway : IPaymentGateway
{
    public string Name => "Razorpay";
    public void ProcessPayment(decimal amount)
    {
        Console.WriteLine($"Processing payment of ${amount} through Razorpay.");
        // Logic to call Razorpay API
    }
}

// 3. The Factory
public class PaymentGatewayFactory
{
    public IPaymentGateway CreateGateway(string gatewayName)
    {
        return gatewayName.ToLower() switch
        {
            "stripe" => new StripeGateway(),
            "paypal" => new PayPalGateway(),
            "razorpay" => new RazorpayGateway(),
            _ => throw new NotSupportedException($"{gatewayName} is not a supported payment gateway."),
        };
    }
}

// 4. Client Code
public class OrderService
{
    private readonly PaymentGatewayFactory _factory;
    
    public OrderService(PaymentGatewayFactory factory)
    {
        _factory = factory;
    }
    
    public void Checkout(decimal orderTotal, string preferredGateway)
    {
        try
        {
            Console.WriteLine($"\nAttempting to process an order of ${orderTotal} using {preferredGateway}.");
            IPaymentGateway gateway = _factory.CreateGateway(preferredGateway);
            gateway.ProcessPayment(orderTotal);
            Console.WriteLine("Payment processed successfully!");
        }
        catch (NotSupportedException ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }
}

// Main execution
public class Program
{
    public static void Main(string[] args)
    {
        var factory = new PaymentGatewayFactory();
        var orderService = new OrderService(factory);
        
        orderService.Checkout(150.75m, "Stripe");
        orderService.Checkout(89.50m, "PayPal");
        orderService.Checkout(250.00m, "Razorpay");
        orderService.Checkout(50.00m, "PayTM"); // Unsupported gateway
    }
}
</code></pre>
                    </div>
                </section>
                
                <section id="quiz">
                    <h2 id="quiz-intro">ðŸ§  Knowledge Check Quiz</h2>
                    <p>Test your understanding of the Factory Pattern.</p>
                    <div id="quiz-container" class="space-y-6 mt-6">
                        <!-- Question 1 -->
                        <div class="quiz-question bg-white p-4 border border-slate-200 rounded-lg">
                            <p class="font-semibold">1. What is the primary intent of the Factory Method pattern?</p>
                            <div class="mt-2 space-y-2">
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q1" value="a" class="mr-2"> To ensure a class only has one instance.</label>
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q1" value="b" class="mr-2"> To define an interface for creating an object, but let subclasses decide which class to instantiate.</label>
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q1" value="c" class="mr-2"> To compose objects into tree structures to represent part-whole hierarchies.</label>
                            </div>
                            <p class="quiz-feedback text-sm mt-2 hidden"></p>
                        </div>
                        <!-- Question 2 -->
                        <div class="quiz-question bg-white p-4 border border-slate-200 rounded-lg">
                            <p class="font-semibold">2. How does the Factory pattern help in adhering to the Open/Closed Principle?</p>
                            <div class="mt-2 space-y-2">
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q2" value="a" class="mr-2"> It forces all object creation to go through a single, unchangeable class.</label>
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q2" value="b" class="mr-2"> It makes code more complex and harder to change.</label>
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q2" value="c" class="mr-2"> It allows new product types to be added by creating new creator subclasses without modifying existing client code or the factory switch statement.</label>
                            </div>
                            <p class="quiz-feedback text-sm mt-2 hidden"></p>
                        </div>
                         <!-- Question 3 -->
                        <div class="quiz-question bg-white p-4 border border-slate-200 rounded-lg">
                            <p class="font-semibold">3. What is the key difference between Factory Method and Abstract Factory?</p>
                            <div class="mt-2 space-y-2">
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q3" value="a" class="mr-2"> They are essentially the same pattern with different names.</label>
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q3" value="b" class="mr-2"> Factory Method creates a single product, while Abstract Factory creates a family of related products.</label>
                                <label class="quiz-option block p-3 border-2 border-slate-300 rounded-lg hover:bg-slate-50 cursor-pointer"><input type="radio" name="q3" value="c" class="mr-2"> Abstract Factory uses inheritance, while Factory Method uses composition.</label>
                            </div>
                            <p class="quiz-feedback text-sm mt-2 hidden"></p>
                        </div>
                    </div>
                    <button id="check-quiz-btn" class="mt-6 bg-[#c78d4e] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#b57b3f] transition-colors">Check Answers</button>
                </section>
                
                 <section id="challenge">
                    <h2 id="challenge-intro">ðŸ’ª Self-Assessment Challenge</h2>
                    <p><strong>Scenario:</strong> You are building a notification system for an application. The system needs to send notifications via different channels: Email, SMS, and Push Notifications. Your task is to design a system using the Factory Pattern that allows the application to easily create and send notifications without coupling the main logic to the specific notification channel implementations.</p>
                    <div class="bg-white p-6 border border-slate-200 rounded-lg mt-6">
                        <p class="font-semibold">Your Challenge:</p>
                        <ol class="list-decimal pl-5 space-y-2 mt-2 text-slate-700">
                           <li>Define an `INotificationSender` interface. It should have a method `Send(string recipient, string message)`.</li>
                           <li>Create concrete classes: `EmailSender`, `SmsSender`, and `PushNotificationSender`.</li>
                           <li>Implement a `NotificationFactory` that creates the appropriate sender based on a type string (e.g., "email", "sms").</li>
                           <li>Write a client `NotificationService` that uses the factory to send a message to a list of recipients, each through a specified channel.</li>
                        </ol>
                        <button id="toggle-solution-btn" class="mt-6 text-sm font-semibold text-[#c78d4e] hover:text-[#b57b3f]">Show/Hide Detailed Solution <i class="fa-solid fa-chevron-down ml-1 text-xs"></i></button>
                        <div id="solution" class="hidden mt-4 border-t border-slate-200 pt-4">
                            <h4 class="font-bold text-lg">Detailed C# Solution:</h4>
                            <div class="code-block my-4">
                                <button class="copy-button" title="Copy to clipboard">
                                    <i class="fa-regular fa-copy"></i> Copy
                                </button>
                                <pre class="bg-slate-800 text-white p-4 rounded-lg shadow-lg overflow-x-auto"><code class="language-csharp">
// 1. Product Interface
public interface INotificationSender
{
    void Send(string recipient, string message);
}

// 2. Concrete Products
public class EmailSender : INotificationSender
{
    public void Send(string recipient, string message)
    {
        Console.WriteLine($"Sending Email to {recipient}: {message}");
    }
}

public class SmsSender : INotificationSender
{
    public void Send(string recipient, string message)
    {
        Console.WriteLine($"Sending SMS to {recipient}: {message}");
    }
}

public class PushNotificationSender : INotificationSender
{
    public void Send(string recipient, string message)
    {
        Console.WriteLine($"Sending Push Notification to device {recipient}: {message}");
    }
}

// 3. Factory
public class NotificationFactory
{
    public INotificationSender GetSender(string type)
    {
        return type.ToLower() switch
        {
            "email" => new EmailSender(),
            "sms" => new SmsSender(),
            "push" => new PushNotificationSender(),
            _ => throw new ArgumentException("Invalid notification type"),
        };
    }
}

// 4. Client
public class NotificationService
{
    private readonly NotificationFactory _factory = new();

    public void SendNotifications(List&lt;Tuple&lt;string, string, string>> notifications)
    {
        foreach (var (type, recipient, message) in notifications)
        {
            try
            {
                INotificationSender sender = _factory.GetSender(type);
                sender.Send(recipient, message);
            }
            catch (ArgumentException ex)
            {
                Console.WriteLine($"Failed to send notification: {ex.Message}");
            }
        }
    }
}

// Main execution
public class Program
{
    public static void Main(string[] args)
    {
        var service = new NotificationService();
        var notificationsToSend = new List&lt;Tuple&lt;string, string, string>>
        {
            Tuple.Create("email", "test@example.com", "Your order has shipped!"),
            Tuple.Create("sms", "+1234567890", "Your package is out for delivery."),
            Tuple.Create("push", "device-token-xyz", "You have a new message."),
            Tuple.Create("fax", "123-456", "This will fail.")
        };
        
        service.SendNotifications(notificationsToSend);
    }
}
</code></pre>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <aside class="w-full lg:w-1/4 mt-12 lg:mt-0">
                <div class="sticky top-8">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">On This Page</h3>
                    <nav id="toc" class="text-sm">
                        
                    </nav>
                </div>
            </aside>
        </div>
    </div>
    
    <footer class="text-center mt-16 py-8 border-t border-slate-200">
        <p class="text-slate-700 font-semibold">Low-Level Design Bootcamp</p>
        <p class="text-sm text-slate-500 mt-2">A personalized learning roadmap curated by Mr. Mahesh Singare.</p>
        <p class="text-xs text-slate-400 mt-4">&copy; 2025. All Rights Reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Table of Contents Generation and Scrolling ---
        const tocContainer = document.getElementById('toc');
        const mainContent = document.querySelector('main');
        const headings = mainContent.querySelectorAll('h2[id], h3[id]');
        const tocLinks = [];

        if(tocContainer) {
            const tocList = document.createElement('ul');
            tocList.className = 'space-y-2';

            headings.forEach(heading => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                
                link.textContent = heading.textContent.replace('âœ…', '').replace('ðŸ§ ', '').replace('ðŸ’ª', '').trim();
                link.href = `#${heading.id}`;
                link.className = 'toc-link text-slate-600 hover:text-[#c78d4e] transition-all duration-200 block';
                
                if (heading.tagName === 'H3') {
                    listItem.style.paddingLeft = '1rem';
                }
                
                listItem.appendChild(link);
                tocList.appendChild(listItem);
                tocLinks.push(link);
            });
            tocContainer.appendChild(tocList);
        }

        const onScroll = () => {
            let currentId = '';
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top >= 0 && rect.top <= 150) {
                   currentId = heading.id;
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentId}`) {
                    link.classList.add('active');
                }
            });
        };
        window.addEventListener('scroll', onScroll);


        // --- Copy-to-Clipboard Functionality ---
        const allCodeBlocks = document.querySelectorAll('.code-block');
        allCodeBlocks.forEach(block => {
            const copyButton = block.querySelector('.copy-button');
            const code = block.querySelector('code');
            if (copyButton && code) {
                copyButton.addEventListener('click', () => {
                    navigator.clipboard.writeText(code.innerText).then(() => {
                        const originalContent = copyButton.innerHTML;
                        copyButton.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                        setTimeout(() => {
                            copyButton.innerHTML = originalContent;
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                    });
                });
            }
        });

        // --- Quiz Functionality ---
        const checkQuizBtn = document.getElementById('check-quiz-btn');
        if (checkQuizBtn) {
            const quizAnswers = { q1: 'b', q2: 'c', q3: 'b' };
            const answerExplanations = {
                q1: 'Correct! The Factory Method pattern defers instantiation to subclasses.',
                q2: 'Correct! You can add new product/creator pairs without changing the code that uses them.',
                q3: 'Correct! Factory Method deals with one product, while Abstract Factory deals with a suite of related products.'
            };
            
            checkQuizBtn.addEventListener('click', () => {
                const questions = document.querySelectorAll('.quiz-question');
                questions.forEach((q, index) => {
                    const qName = `q${index + 1}`;
                    const selected = document.querySelector(`input[name="${qName}"]:checked`);
                    const feedbackEl = q.querySelector('.quiz-feedback');
                    const options = q.querySelectorAll('.quiz-option');

                    options.forEach(opt => {
                        opt.classList.remove('correct', 'incorrect');
                        const input = opt.querySelector('input');
                        if (input.value === quizAnswers[qName]) {
                           opt.classList.add('correct'); // Mark the correct answer regardless
                        }
                    });

                    if (selected) {
                        if (selected.value === quizAnswers[qName]) {
                            feedbackEl.textContent = answerExplanations[qName];
                            feedbackEl.className = 'quiz-feedback text-sm mt-2 text-green-700 block';
                        } else {
                            const selectedLabel = selected.parentElement;
                            selectedLabel.classList.add('incorrect');
                            feedbackEl.textContent = 'Incorrect. The correct answer is highlighted in green.';
                            feedbackEl.className = 'quiz-feedback text-sm mt-2 text-red-700 block';
                        }
                    } else {
                         feedbackEl.textContent = 'Please select an answer. The correct one is highlighted.';
                         feedbackEl.className = 'quiz-feedback text-sm mt-2 text-slate-600 block';
                    }
                });
            });
        }
        
        // --- Challenge Solution Toggle ---
        const toggleSolutionBtn = document.getElementById('toggle-solution-btn');
        const solutionDiv = document.getElementById('solution');
        const chevron = toggleSolutionBtn.querySelector('i');

        if (toggleSolutionBtn && solutionDiv) {
            toggleSolutionBtn.addEventListener('click', () => {
                const isHidden = solutionDiv.classList.contains('hidden');
                if (isHidden) {
                    solutionDiv.classList.remove('hidden');
                    chevron.classList.remove('fa-chevron-down');
                    chevron.classList.add('fa-chevron-up');
                } else {
                    solutionDiv.classList.add('hidden');
                    chevron.classList.remove('fa-chevron-up');
                    chevron.classList.add('fa-chevron-down');
                }
            });
        }
    });
    </script>
</body>
</html>
