<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 35: Observer Pattern</title>
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-column main content area with a sticky right-hand table of contents. This linear, top-down structure is ideal for a lesson page, guiding the user from foundational theory to practical application. Key interactions include an interactive visualization to demonstrate the pattern's flow, a multi-question quiz for knowledge checks, and togglable solutions for challenges. This design prioritizes a structured learning path and easy navigation. -->
    <!-- Visualization & Content Choices: Report Info: UML Diagram -> Goal: Organize/Structure -> Viz Method: HTML/CSS Diagram -> Interaction: Static -> Justification: Clearly represents class relationships without external libraries, adhering to no-SVG rule. Report Info: Pattern Flow -> Goal: Inform/Demonstrate -> Viz Method: Interactive HTML elements (Subject/Observers) -> Interaction: User clicks button to update Subject, Observers update via JS -> Justification: Provides a hands-on, visual understanding of the notification mechanism. Report Info: Code examples -> Goal: Inform/Practice -> Method: Styled <pre><code> blocks -> Interaction: Copy-to-clipboard button -> Justification: Improves user experience for practical application. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f7f4;
        }
        .font-lexend { font-family: 'Lexend', sans-serif; }
        .toc-link.active {
            color: #4f46e5;
            font-weight: 600;
            border-left-color: #4f46e5;
        }
        .code-block {
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            background-color: #4a5568;
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #2d3748;
        }
        .quiz-option.selected {
            outline: 2px solid #4f46e5;
            background-color: #e0e7ff;
        }
        .quiz-option.correct {
            outline: 2px solid #16a34a;
            background-color: #dcfce7;
        }
        .quiz-option.incorrect {
            outline: 2px solid #dc2626;
            background-color: #fee2e2;
        }
    </style>
</head>
<body class="bg-[#f8f7f4] text-slate-800">

    <div class="bg-slate-100/80 border-b border-slate-200">
        <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 relative">
            <header class="text-center">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-800 mt-1 tracking-tight font-lexend">Low-Level Design Bootcamp</h1>
                <p class="mt-3 text-slate-600 max-w-xl mx-auto">Your 60-Day Interactive Roadmap to Mastering Backend Engineering.</p>
            </header>
            <a href="roadmap.html?week=5" class="absolute top-1/2 -translate-y-1/2 right-4 sm:right-6 lg:right-8 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors shadow-sm">
                Return to Homepage
            </a>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="flex flex-col lg:flex-row gap-12">

            <main class="w-full lg:w-3/4">
                <div class="space-y-16">
                    
                    <section id="introduction">
                        <span class="text-sm font-semibold text-indigo-600 bg-indigo-100 py-1 px-3 rounded-full">Day 35</span>
                        <h2 class="text-4xl font-extrabold font-lexend mt-4">Observer Pattern</h2>
                        <p class="mt-4 text-lg text-slate-600">The Observer Pattern defines a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically. It's the cornerstone of event-driven programming, promoting loose coupling and broadcast communication.</p>
                    </section>

                    <section id="theory" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">Core Theory</h3>
                        <div class="mt-6 space-y-8">
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                                <h4 class="text-xl font-semibold font-lexend">Publish/Subscribe (Pub/Sub) Pattern</h4>
                                <p class="mt-2 text-slate-600">The Observer pattern is often implemented using a mechanism called Publish/Subscribe. Imagine a magazine subscription: you (the subscriber) tell the publisher you're interested. When a new issue is released, the publisher doesn't need to know who you are specifically; they just send it to everyone on their subscription list. In software, this translates to:</p>
                                <ul class="mt-4 list-disc list-inside space-y-2 text-slate-600">
                                    <li><strong>Publisher (Subject):</strong> The object of interest. It maintains a list of subscribers and sends out notifications when its state changes. It doesn't know anything about the concrete subscribers, only that they implement a certain interface.</li>
                                    <li><strong>Subscriber (Observer):</strong> An object that wants to be notified of the publisher's state changes. It subscribes to the publisher and implements an `Update` method that the publisher calls.</li>
                                </ul>
                                <div class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                                    <p><strong class="font-semibold text-amber-800">Analogy:</strong> A YouTube channel is a Publisher. You, as a Subscriber, click the "Subscribe" button. When the creator uploads a new video (a state change), YouTube's notification system (the mechanism) automatically sends a notification to you and all other subscribers.</p>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                                <h4 class="text-xl font-semibold font-lexend">Observer in .NET Events</h4>
                                <p class="mt-2 text-slate-600">In C# and the .NET framework, the Observer pattern is a first-class citizen, implemented through <strong class="font-semibold">events</strong> and <strong class="font-semibold">delegates</strong>. This provides a clean, type-safe way to implement the pattern.</p>
                                <ul class="mt-4 list-disc list-inside space-y-2 text-slate-600">
                                    <li><strong>Delegate:</strong> A type that defines a method signature. It's like a contract for a method. In Observer, it defines the signature of the notification handler.</li>
                                    <li><strong>Event:</strong> A special kind of multicast delegate that can only be invoked from within the class that declares it. This provides encapsulation and safety, ensuring only the publisher can raise the event.</li>
                                </ul>
                                <div class="mt-4 code-block">
                                    <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">// 1. Define a delegate for the event handler
public delegate void PriceChangedHandler(object sender, decimal newPrice);

// 2. The Publisher class
public class Stock
{
    // 3. Define the event based on the delegate
    public event PriceChangedHandler PriceChanged;

    private decimal price;
    public decimal Price
    {
        get { return price; }
        set
        {
            if (price != value)
            {
                price = value;
                // 4. Raise the event to notify subscribers
                OnPriceChanged(price);
            }
        }
    }

    protected virtual void OnPriceChanged(decimal newPrice)
    {
        // Check if there are any subscribers before raising the event
        PriceChanged?.Invoke(this, newPrice);
    }
}

// 5. A Subscriber class
public class Investor
{
    public void Subscribe(Stock stock)
    {
        // Use the += operator to subscribe a method to the event
        stock.PriceChanged += Stock_PriceChanged;
    }

    private void Stock_PriceChanged(object sender, decimal newPrice)
    {
        Console.WriteLine($"Notification: Stock price changed to {newPrice:C}");
    }
}
</code></pre>
                                    <button class="copy-button">Copy</button>
                                </div>
                            </div>
                            
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                                <h4 class="text-xl font-semibold font-lexend">The Power of Loose Coupling</h4>
                                <p class="mt-2 text-slate-600">The most significant advantage of the Observer pattern is achieving <strong class="font-semibold">loose coupling</strong>. The Subject (publisher) and Observers (subscribers) are not tightly bound. The Subject only knows it has a list of objects that conform to the Observer interface. It doesn't care what they are or what they do with the notification. This means:</p>
                                <ul class="mt-4 list-disc list-inside space-y-2 text-slate-600">
                                    <li>You can add new Observers at any time without modifying the Subject.</li>
                                    <li>You can reuse Subjects and Observers independently.</li>
                                    <li>Changes to an Observer will not affect the Subject, and vice versa (as long as the interface contract is maintained).</li>
                                </ul>
                                <p class="mt-4 text-slate-600">This flexibility is crucial for building scalable and maintainable systems, especially in UIs, distributed systems, and microservices architectures.</p>
                            </div>
                        </div>
                    </section>

                    <section id="uml" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">UML Diagram</h3>
                        <p class="mt-4 text-slate-600">The UML diagram for the Observer pattern clearly illustrates the relationships between the participants. The Subject and Observer are decoupled through interfaces, allowing for the one-to-many relationship where one ConcreteSubject can notify many ConcreteObservers.</p>
                        <div class="mt-6 bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                            <div class="flex flex-col md:flex-row gap-8 justify-center items-start relative">
                                <!-- Dashed lines -->
                                <div class="absolute top-1/2 left-0 w-full h-px bg-slate-300 border-t border-dashed -mt-12 hidden md:block"></div>
                                
                                <!-- Subject Side -->
                                <div class="w-full md:w-1/2 space-y-4 text-center z-10">
                                    <div class="p-4 bg-slate-50 border border-slate-300 rounded-md">
                                        <div class="font-semibold italic">¬´interface¬ª ISubject</div>
                                        <hr class="my-2">
                                        <div class="text-left text-sm">
                                            + Attach(observer) <br>
                                            + Detach(observer) <br>
                                            + Notify()
                                        </div>
                                    </div>
                                    <div class="text-2xl text-slate-400 font-mono">&#9650;</div>
                                    <div class="p-4 bg-white border-2 border-slate-400 rounded-md">
                                        <div class="font-semibold">ConcreteSubject</div>
                                        <hr class="my-2">
                                        <div class="text-left text-sm">
                                            - observers: List&lt;IObserver&gt; <br>
                                            - state: T <br>
                                            <hr class="my-1 border-slate-200">
                                            + GetState() <br>
                                            + SetState(newState)
                                        </div>
                                    </div>
                                </div>

                                <!-- Observer Side -->
                                <div class="w-full md:w-1/2 space-y-4 text-center z-10">
                                    <div class="p-4 bg-slate-50 border border-slate-300 rounded-md">
                                        <div class="font-semibold italic">¬´interface¬ª IObserver</div>
                                        <hr class="my-2">
                                        <div class="text-left text-sm">
                                            + Update(subject)
                                        </div>
                                    </div>
                                    <div class="text-2xl text-slate-400 font-mono">&#9650;</div>
                                    <div class="p-4 bg-white border-2 border-slate-400 rounded-md">
                                        <div class="font-semibold">ConcreteObserver</div>
                                        <hr class="my-2">
                                        <div class="text-left text-sm">
                                            - observerState: T
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-8 text-sm text-slate-500">
                                <p><strong class="font-semibold">ISubject:</strong> Defines the interface for attaching, detaching, and notifying observers.</p>
                                <p><strong class="font-semibold">ConcreteSubject:</strong> Implements the ISubject interface, stores state that interests observers, and sends notifications when its state changes.</p>
                                <p><strong class="font-semibold">IObserver:</strong> Defines the updating interface for objects that should be notified of changes in a subject.</p>
                                <p><strong class="font-semibold">ConcreteObserver:</strong> Implements the IObserver interface and keeps a reference to a ConcreteSubject object to get its state when updated.</p>
                            </div>
                        </div>
                    </section>
                    
                    <section id="interactive-viz" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">Interactive Visualization</h3>
                        <p class="mt-4 text-slate-600">Let's see the Observer pattern in action. Here we have a News Agency (the Subject) and several Subscribers (Observers). When the agency publishes a new headline, all subscribers are instantly notified. Click the button to publish a new breaking story!</p>
                        <div class="mt-6 bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                            <div class="flex flex-col items-center">
                                <div id="subject" class="bg-indigo-100 border-2 border-indigo-400 p-4 rounded-lg w-full max-w-md text-center">
                                    <h4 class="font-bold text-indigo-800 text-lg">üì∞ News Agency HQ</h4>
                                    <p class="mt-2 text-sm text-indigo-700">Current Headline:</p>
                                    <p id="headline" class="font-semibold text-lg mt-1">"Market remains stable."</p>
                                </div>
                                <button id="publish-btn" class="mt-4 bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors shadow">Publish New Headline</button>
                            </div>
                            <div class="mt-8">
                                <h4 class="text-lg font-semibold text-center text-slate-700">Subscribers</h4>
                                <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div class="observer-card border bg-slate-50 p-4 rounded-md border-slate-200">
                                        <h5 class="font-semibold">üì± Mobile App User</h5>
                                        <p class="text-xs text-slate-500">Last notification:</p>
                                        <p class="notification-area text-sm mt-1">"Market remains stable."</p>
                                    </div>
                                    <div class="observer-card border bg-slate-50 p-4 rounded-md border-slate-200">
                                        <h5 class="font-semibold">üíª Website Visitor</h5>
                                        <p class="text-xs text-slate-500">Last notification:</p>
                                        <p class="notification-area text-sm mt-1">"Market remains stable."</p>
                                    </div>
                                    <div class="observer-card border bg-slate-50 p-4 rounded-md border-slate-200">
                                        <h5 class="font-semibold">‚úâÔ∏è Email Subscriber</h5>
                                        <p class="text-xs text-slate-500">Last notification:</p>
                                        <p class="notification-area text-sm mt-1">"Market remains stable."</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="coding-practice" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">Coding Practice</h3>
                        <p class="mt-4 text-slate-600">Apply your knowledge with these coding exercises. Solutions are provided in C# to demonstrate a complete, type-safe implementation.</p>
                        
                        <div class="mt-6 space-y-8">
                            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                                <h4 class="text-xl font-semibold font-lexend">[Easy] Weather Station</h4>
                                <p class="mt-2 text-slate-600">Create a simple Weather Station (Subject) that notifies multiple display clients (Observers) when the weather data (temperature, humidity) changes.</p>
                                <div class="mt-4 code-block">
                                    <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
using System;
using System.Collections.Generic;

public interface IWeatherObserver
{
    void Update(float temperature, float humidity);
}

public class WeatherStation
{
    private List&lt;IWeatherObserver&gt; _observers = new List&lt;IWeatherObserver&gt;();
    private float _temperature;
    private float _humidity;

    public void Attach(IWeatherObserver observer)
    {
        _observers.Add(observer);
    }

    public void Detach(IWeatherObserver observer)
    {
        _observers.Remove(observer);
    }

    public void Notify()
    {
        foreach (var observer in _observers)
        {
            observer.Update(_temperature, _humidity);
        }
    }

    public void SetMeasurements(float temperature, float humidity)
    {
        this._temperature = temperature;
        this._humidity = humidity;
        Console.WriteLine("\nWeather station updating measurements...");
        Notify();
    }
}

public class PhoneDisplay : IWeatherObserver
{
    public void Update(float temperature, float humidity)
    {
        Console.WriteLine($"Phone Display: Temp is {temperature}¬∞C, Humidity is {humidity}%");
    }
}

public class WindowDisplay : IWeatherObserver
{
    public void Update(float temperature, float humidity)
    {
        Console.WriteLine($"Window Display: It's currently {temperature}¬∞C with {humidity}% humidity.");
    }
}

public class WeatherProgram
{
    public static void Main(string[] args)
    {
        var weatherStation = new WeatherStation();
        var phoneDisplay = new PhoneDisplay();
        var windowDisplay = new WindowDisplay();

        weatherStation.Attach(phoneDisplay);
        weatherStation.Attach(windowDisplay);

        weatherStation.SetMeasurements(25.5f, 65f);
        weatherStation.SetMeasurements(28.0f, 70f);

        weatherStation.Detach(phoneDisplay);
        weatherStation.SetMeasurements(22.1f, 60f);
    }
}
</code></pre>
                                    <button class="copy-button">Copy</button>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                                <h4 class="text-xl font-semibold font-lexend">[Medium] Chatroom Observer</h4>
                                <p class="mt-2 text-slate-600">Implement a chatroom system. A Chatroom (Subject) notifies all Users (Observers) in the room when a new message is sent.</p>
                                <div class="mt-4 code-block">
                                    <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
using System;
using System.Collections.Generic;

// Observer interface
public interface IChatUser
{
    string UserName { get; }
    void ReceiveMessage(string sender, string message);
}

// Subject
public class Chatroom
{
    private List&lt;IChatUser&gt; _users = new List&lt;IChatUser&gt;();

    public void Join(IChatUser user)
    {
        _users.Add(user);
        Console.WriteLine($"[{user.UserName} has joined the chat.]");
    }

    public void Leave(IChatUser user)
    {
        _users.Remove(user);
        Console.WriteLine($"[{user.UserName} has left the chat.]");
    }

    public void BroadcastMessage(string sender, string message)
    {
        foreach (var user in _users)
        {
            if (user.UserName != sender)
            {
                user.ReceiveMessage(sender, message);
            }
        }
    }
}

// Concrete Observer
public class ChatUser : IChatUser
{
    public string UserName { get; private set; }
    private Chatroom _chatroom;

    public ChatUser(string userName, Chatroom chatroom)
    {
        UserName = userName;
        _chatroom = chatroom;
        _chatroom.Join(this);
    }

    public void SendMessage(string message)
    {
        Console.WriteLine($"[{UserName} sends]: {message}");
        _chatroom.BroadcastMessage(UserName, message);
    }

    public void ReceiveMessage(string sender, string message)
    {
        Console.WriteLine($"[{UserName} received from {sender}]: {message}");
    }
}

public class ChatProgram
{
    public static void Main(string[] args)
    {
        var chatroom = new Chatroom();

        var user1 = new ChatUser("Alice", chatroom);
        var user2 = new ChatUser("Bob", chatroom);
        var user3 = new ChatUser("Charlie", chatroom);

        Console.WriteLine();
        user1.SendMessage("Hello everyone!");
        Console.WriteLine();
        user2.SendMessage("Hey Alice!");
    }
}
</code></pre>
                                    <button class="copy-button">Copy</button>
                                </div>
                            </div>
                            
                             <div class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                                <h4 class="text-xl font-semibold font-lexend">[Hard] Stock Market Observer</h4>
                                <p class="mt-2 text-slate-600">Design a stock market monitoring system. A `StockTicker` (Subject) sends updates about multiple stocks. `Investors` (Observers) can subscribe to specific stocks and will only be notified of price changes for those stocks. This introduces the concept of filtering notifications.</p>
                                <div class="mt-4 code-block">
                                    <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
using System;
using System.Collections.Generic;
using System.Linq;

public class Stock
{
    public string Symbol { get; }
    public decimal Price { get; private set; }

    public Stock(string symbol, decimal initialPrice)
    {
        Symbol = symbol;
        Price = initialPrice;
    }

    public void UpdatePrice(decimal newPrice)
    {
        Price = newPrice;
    }
}

// Observer interface
public interface IInvestor
{
    void Update(Stock stock);
}

// Subject
public class StockTicker
{
    private Dictionary&lt;string, List&lt;IInvestor&gt;&gt; _subscriptions = new Dictionary&lt;string, List&lt;IInvestor&gt;&gt;();
    private Dictionary&lt;string, Stock&gt; _stocks = new Dictionary&lt;string, Stock&gt;();

    public void AddStock(Stock stock)
    {
        _stocks[stock.Symbol] = stock;
        _subscriptions[stock.Symbol] = new List&lt;IInvestor&gt;();
    }

    public void Subscribe(IInvestor investor, string symbol)
    {
        if (_subscriptions.ContainsKey(symbol))
        {
            _subscriptions[symbol].Add(investor);
        }
    }

    public void Unsubscribe(IInvestor investor, string symbol)
    {
        if (_subscriptions.ContainsKey(symbol))
        {
            _subscriptions[symbol].Remove(investor);
        }
    }

    public void UpdateStockPrice(string symbol, decimal newPrice)
    {
        if (_stocks.TryGetValue(symbol, out Stock stock))
        {
            stock.UpdatePrice(newPrice);
            Console.WriteLine($"\nTicker Update: {symbol} is now {newPrice:C}. Notifying subscribers...");
            Notify(stock);
        }
    }

    private void Notify(Stock stock)
    {
        if (_subscriptions.TryGetValue(stock.Symbol, out List&lt;IInvestor&gt; subscribers))
        {
            foreach (var subscriber in subscribers)
            {
                subscriber.Update(stock);
            }
        }
    }
}

// Concrete Observer
public class Investor : IInvestor
{
    public string Name { get; }

    public Investor(string name)
    {
        Name = name;
    }

    public void Update(Stock stock)
    {
        Console.WriteLine($"Investor {Name}: Received update for {stock.Symbol}, new price is {stock.Price:C}.");
    }
}

public class StockMarketProgram
{
    public static void Main(string[] args)
    {
        var ticker = new StockTicker();
        ticker.AddStock(new Stock("GOOG", 2800.00m));
        ticker.AddStock(new Stock("AAPL", 150.00m));

        var investor1 = new Investor("Warren");
        var investor2 = new Investor("Susan");

        ticker.Subscribe(investor1, "GOOG");
        ticker.Subscribe(investor1, "AAPL");
        ticker.Subscribe(investor2, "GOOG");
        
        ticker.UpdateStockPrice("GOOG", 2825.50m);
        ticker.UpdateStockPrice("AAPL", 152.75m);
    }
}
</code></pre>
                                    <button class="copy-button">Copy</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section id="case-study" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">Case Study: Event-driven Notification Service</h3>
                        <p class="mt-4 text-slate-600">Consider a modern e-commerce platform. When an order's status changes (e.g., from 'Processing' to 'Shipped'), multiple downstream services need to react: the Email service sends a confirmation, the Inventory service updates stock levels, and the Analytics service logs the event. A tightly-coupled system would require the Order service to know about and call each of these services directly. This is brittle and hard to extend.</p>
                        <div class="mt-6 bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                             <h4 class="text-xl font-semibold font-lexend">Solution with Observer Pattern (EventBus)</h4>
                             <p class="mt-2 text-slate-600">A better approach is to use an <strong class="font-semibold">EventBus</strong>, a centralized implementation of the Observer pattern.
                             </p>
                            <ol class="mt-4 list-decimal list-inside space-y-2">
                                <li><strong>Order Service (Publisher):</strong> When an order is shipped, it doesn't call other services. It simply publishes an `OrderShippedEvent` to the EventBus. It has no knowledge of who is listening.</li>
                                <li><strong>EventBus (Mediator/Subject):</strong> This central component manages subscriptions. It knows that the Email, Inventory, and Analytics services are subscribed to the `OrderShippedEvent`.</li>
                                <li><strong>Downstream Services (Subscribers):</strong> Each service subscribes to the events it cares about. The Email service listens for `OrderShippedEvent` and sends an email. The Inventory service listens and adjusts stock. If a new SMS notification service is added later, it simply subscribes to the same event without any changes to the Order service.</li>
                            </ol>
                            <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                                <p><strong class="font-semibold text-green-800">Benefits:</strong> This design is incredibly flexible and scalable. The Order service is completely decoupled from the notification logic. New subscribers can be added or removed dynamically, making the system easy to maintain and evolve. This is the core principle behind microservices communication.</p>
                            </div>
                        </div>
                    </section>
                    
                    <section id="knowledge-check" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">Knowledge Check Quiz</h3>
                        <p class="mt-4 text-slate-600">Test your understanding of the Observer pattern.</p>
                        <div id="quiz-container" class="mt-6 space-y-6">
                            
                        </div>
                        <button id="submit-quiz-btn" class="mt-6 bg-indigo-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors shadow disabled:bg-slate-400 disabled:cursor-not-allowed">Submit Answers</button>
                        <div id="quiz-results" class="mt-4 font-semibold"></div>
                    </section>

                    <section id="self-assessment" class="scroll-mt-24">
                        <h3 class="text-3xl font-bold font-lexend">Self-Assessment Challenge</h3>
                        <div class="mt-6 bg-white p-6 rounded-lg shadow-sm border border-slate-200">
                            <h4 class="text-xl font-semibold font-lexend">Challenge: A Simple EventBus</h4>
                            <p class="mt-2 text-slate-600">Implement a generic `EventBus` in C#. This bus should allow objects to subscribe to events of a specific type (`T`) and publish events of that type. All subscribers for that event type should be notified.</p>
                            <p class="mt-2 text-sm text-slate-500"><strong>Requirements:</strong></p>
                            <ul class="mt-2 list-disc list-inside text-sm text-slate-600 space-y-1">
                                <li>A `Subscribe` method that takes an `Action<T>` delegate.</li>
                                <li>A `Publish` method that takes an event object of type `T`.</li>
                                <li>The system should support different event types (e.g., `UserLoggedInEvent`, `OrderPlacedEvent`).</li>
                            </ul>
                            <button id="toggle-solution-btn" class="mt-6 bg-slate-200 text-slate-700 text-sm font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">Show Solution</button>
                            <div id="solution-block" class="hidden mt-4">
                                <div class="code-block">
                                    <pre class="bg-slate-800 text-white p-4 rounded-md text-sm overflow-x-auto"><code class="language-csharp">
using System;
using System.Collections.Generic;

public class EventBus
{
    private static readonly EventBus _instance = new EventBus();
    public static EventBus Instance => _instance;
    
    private readonly Dictionary&lt;Type, List&lt;Delegate&gt;&gt; _subscriptions = new Dictionary&lt;Type, List&lt;Delegate&gt;&gt;();

    private EventBus() {}

    public void Subscribe&lt;T&gt;(Action&lt;T&gt; action)
    {
        var eventType = typeof(T);
        if (!_subscriptions.ContainsKey(eventType))
        {
            _subscriptions[eventType] = new List&lt;Delegate&gt;();
        }
        _subscriptions[eventType].Add(action);
    }

    public void Publish&lt;T&gt;(T eventData)
    {
        var eventType = typeof(T);
        if (_subscriptions.ContainsKey(eventType))
        {
            foreach (var actionDelegate in _subscriptions[eventType])
            {
                // Safely cast and invoke the delegate
                (actionDelegate as Action&lt;T&gt;)?.Invoke(eventData);
            }
        }
    }
}

// --- Example Usage ---

// 1. Define event data structures
public class UserLoggedInEvent
{
    public string Username { get; set; }
    public DateTime LoginTime { get; set; }
}

public class OrderPlacedEvent
{
    public int OrderId { get; set; }
    public decimal Amount { get; set; }
}

// 2. Define subscribers
public class AuditService
{
    public AuditService()
    {
        EventBus.Instance.Subscribe&lt;UserLoggedInEvent&gt;(OnUserLoggedIn);
    }
    
    private void OnUserLoggedIn(UserLoggedInEvent e)
    {
        Console.WriteLine($"[Audit] User '{e.Username}' logged in at {e.LoginTime}.");
    }
}

public class EmailService
{
    public EmailService()
    {
        EventBus.Instance.Subscribe&lt;OrderPlacedEvent&gt;(OnOrderPlaced);
    }

    private void OnOrderPlaced(OrderPlacedEvent e)
    {
        Console.WriteLine($"[Email] Sending confirmation for Order #{e.OrderId} with amount {e.Amount:C}.");
    }
}


// 3. Main program
public class EventBusProgram
{
    public static void Main(string[] args)
    {
        // Instantiate subscribers, which will auto-subscribe in their constructors
        var auditService = new AuditService();
        var emailService = new EmailService();

        Console.WriteLine("Publishing a UserLoggedInEvent...");
        EventBus.Instance.Publish(new UserLoggedInEvent { Username = "jdoe", LoginTime = DateTime.UtcNow });
        
        Console.WriteLine("\nPublishing an OrderPlacedEvent...");
        EventBus.Instance.Publish(new OrderPlacedEvent { OrderId = 123, Amount = 99.95m });
    }
}
</code></pre>
                                    <button class="copy-button">Copy</button>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>
            </main>

            <aside class="w-full lg:w-1/4">
                <div class="sticky top-24">
                    <h4 class="font-semibold text-slate-800 mb-4">On This Page</h4>
                    <nav id="toc-nav" class="flex flex-col space-y-2 border-l-2 border-slate-200">
                        <a href="#introduction" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Introduction</a>
                        <a href="#theory" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Core Theory</a>
                        <a href="#uml" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">UML Diagram</a>
                        <a href="#interactive-viz" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Interactive Visualization</a>
                        <a href="#coding-practice" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Coding Practice</a>
                        <a href="#case-study" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Case Study</a>
                        <a href="#knowledge-check" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Knowledge Check</a>
                        <a href="#self-assessment" class="toc-link pl-4 py-1 text-sm text-slate-600 hover:text-indigo-600 transition-colors border-l-2 border-transparent">Self-Assessment</a>
                    </nav>
                </div>
            </aside>

        </div>
    </div>

    <footer class="text-center mt-16 py-8 border-t border-slate-200">
        <p class="text-slate-700 font-semibold">Low-Level Design Bootcamp</p>
        <p class="text-sm text-slate-500 mt-2">A personalized learning roadmap curated by Mr. Mahesh Singare.</p>
        <p class="text-xs text-slate-400 mt-4">&copy; 2025. All Rights Reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Copy to Clipboard functionality ---
        const allCodeBlocks = document.querySelectorAll('.code-block');
        allCodeBlocks.forEach(block => {
            const copyButton = block.querySelector('.copy-button');
            const code = block.querySelector('code').innerText;
            copyButton.addEventListener('click', () => {
                navigator.clipboard.writeText(code).then(() => {
                    copyButton.textContent = 'Copied!';
                    setTimeout(() => {
                        copyButton.textContent = 'Copy';
                    }, 2000);
                });
            });
        });

        // --- Sticky Table of Contents active state ---
        const tocLinks = document.querySelectorAll('.toc-link');
        const sections = document.querySelectorAll('section[id]');
        
        const observerOptions = {
            rootMargin: '-100px 0px -50% 0px',
            threshold: 0
        };

        const sectionObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    tocLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('href') === `#${id}`) {
                            link.classList.add('active');
                        }
                    });
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            sectionObserver.observe(section);
        });
        
        // --- Interactive Visualization Logic ---
        const publishBtn = document.getElementById('publish-btn');
        const headlineEl = document.getElementById('headline');
        const notificationAreas = document.querySelectorAll('.notification-area');

        const headlines = [
            "Tech stocks surge on new innovations!",
            "Global markets enter a period of calm.",
            "BREAKING: Unexpected merger announced.",
            "Economic outlook revised upwards.",
            "New regulations impact the energy sector."
        ];
        let headlineIndex = 0;

        publishBtn.addEventListener('click', () => {
            headlineIndex = (headlineIndex + 1) % headlines.length;
            const newHeadline = headlines[headlineIndex];
            
            headlineEl.textContent = `"${newHeadline}"`;
            notificationAreas.forEach(area => {
                area.parentElement.classList.remove('bg-slate-50', 'border-slate-200');
                area.parentElement.classList.add('bg-green-100', 'border-green-300', 'transition-colors');
                area.textContent = `"${newHeadline}"`;
                
                setTimeout(() => {
                    area.parentElement.classList.remove('bg-green-100', 'border-green-300');
                    area.parentElement.classList.add('bg-slate-50', 'border-slate-200');
                }, 1500);
            });
        });

        // --- Self-Assessment Solution Toggle ---
        const toggleSolutionBtn = document.getElementById('toggle-solution-btn');
        const solutionBlock = document.getElementById('solution-block');
        toggleSolutionBtn.addEventListener('click', () => {
            const isHidden = solutionBlock.classList.contains('hidden');
            solutionBlock.classList.toggle('hidden');
            toggleSolutionBtn.textContent = isHidden ? 'Hide Solution' : 'Show Solution';
        });

        // --- Knowledge Check Quiz Logic ---
        const quizData = [
            {
                question: "What is the primary purpose of the Observer pattern?",
                options: [
                    "To create objects without specifying the exact class.",
                    "To ensure a class only has one instance.",
                    "To define a one-to-many dependency between objects, enabling automatic updates.",
                    "To encapsulate algorithms inside a single class."
                ],
                answer: 2
            },
            {
                question: "In the Observer pattern, what is 'loose coupling'?",
                options: [
                    "The Subject and Observer classes are in the same file.",
                    "The Subject knows the concrete class of every Observer.",
                    "The Subject and Observer are not tightly connected; the Subject only knows about the Observer interface.",
                    "The Observer can change the Subject's state directly."
                ],
                answer: 2
            },
            {
                question: "In .NET, which language features are commonly used to implement the Observer pattern?",
                options: [
                    "Interfaces and Abstract Classes",
                    "Events and Delegates",
                    "Generics and LINQ",
                    "Async and Await"
                ],
                answer: 1
            },
            {
                question: "If you add a new type of Observer to a system, what changes are needed in the Subject class?",
                options: [
                    "You must add an 'if' statement to handle the new type.",
                    "The Subject's 'Notify' method must be completely rewritten.",
                    "You need to recompile the entire application.",
                    "No changes are needed in the Subject, as long as the new Observer implements the correct interface."
                ],
                answer: 3
            }
        ];

        const quizContainer = document.getElementById('quiz-container');
        const submitBtn = document.getElementById('submit-quiz-btn');
        const resultsEl = document.getElementById('quiz-results');
        let userAnswers = {};

        quizData.forEach((q, index) => {
            const questionEl = document.createElement('div');
            questionEl.className = 'bg-white p-6 rounded-lg shadow-sm border border-slate-200';
            
            const questionText = document.createElement('p');
            questionText.className = 'font-semibold text-slate-700';
            questionText.textContent = `${index + 1}. ${q.question}`;
            questionEl.appendChild(questionText);

            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'mt-4 space-y-2';
            
            q.options.forEach((option, optionIndex) => {
                const optionLabel = document.createElement('label');
                optionLabel.className = 'quiz-option block p-3 rounded-md border border-slate-300 cursor-pointer hover:bg-slate-100 transition-colors';
                
                const optionInput = document.createElement('input');
                optionInput.type = 'radio';
                optionInput.name = `question-${index}`;
                optionInput.value = optionIndex;
                optionInput.className = 'sr-only';

                optionInput.addEventListener('change', () => {
                    userAnswers[index] = parseInt(optionInput.value);
                    // Update visual selection
                    optionsContainer.querySelectorAll('.quiz-option').forEach(l => l.classList.remove('selected'));
                    optionLabel.classList.add('selected');
                });

                optionLabel.appendChild(optionInput);
                optionLabel.append(` ${option}`);
                optionsContainer.appendChild(optionLabel);
            });
            
            questionEl.appendChild(optionsContainer);
            quizContainer.appendChild(questionEl);
        });

        submitBtn.addEventListener('click', () => {
            let score = 0;
            quizContainer.querySelectorAll('.quiz-option').forEach(label => {
                label.classList.remove('selected');
                label.style.cursor = 'default';
            });
            quizContainer.querySelectorAll('input[type="radio"]').forEach(input => {
                input.disabled = true;
            });

            quizData.forEach((q, index) => {
                const selectedAnswer = userAnswers[index];
                const options = quizContainer.querySelectorAll(`[name="question-${index}"]`);
                const correctOptionEl = options[q.answer].parentElement;

                correctOptionEl.classList.add('correct');

                if (selectedAnswer === q.answer) {
                    score++;
                } else if (selectedAnswer !== undefined) {
                    const selectedOptionEl = options[selectedAnswer].parentElement;
                    selectedOptionEl.classList.add('incorrect');
                }
            });

            resultsEl.textContent = `You scored ${score} out of ${quizData.length}.`;
            submitBtn.disabled = true;
        });

    });
    </script>
</body>
</html>
