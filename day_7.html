<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 7: Static Classes & Records - OOP Foundations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF;
            color: #3D352E;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
        }
        pre {
            background-color: #1E1E1E;
            color: #D4D4D4;
            font-family: 'Roboto Mono', monospace;
            border-radius: 0.5rem;
            padding: 1.25rem;
            position: relative;
            overflow-x: auto;
            border: 1px solid #3a404a;
        }
        pre code {
            background-color: transparent !important;
            color: inherit;
            padding: 0;
            font-size: inherit;
            border-radius: 0;
        }
        .prose-custom :not(pre) > code {
            background-color: #F3F4F6;
            color: #C06A47;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
        }
        .btn {
            display: inline-block;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            text-align: center;
        }
        .btn-primary {
            background-color: #C06A47; /* Sienna */
            color: #FFFFFF;
            border: 1px solid transparent;
        }
        .btn-primary:hover {
            background-color: #A95A3A; /* Darker Sienna */
        }
        .copy-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: #4A5568;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            opacity: 0;
            transition: all 0.2s;
        }
        pre:hover .copy-btn {
            opacity: 1;
        }
        .copy-btn:hover {
            background-color: #2D3748;
        }
        .toc-link {
            transition: all 0.2s ease-in-out;
            border-left: 2px solid transparent;
        }
        .toc-link:hover {
            color: #3E8A86; /* Teal */
            border-left-color: #3E8A86;
        }
        .toc-link.active {
            color: #C06A47; /* Sienna */
            border-left-color: #C06A47;
            font-weight: 700;
        }
        .prose-custom { max-width: 80ch; }
        .prose-custom h2 { margin-top: 2.5em; margin-bottom: 1em; }
        .prose-custom h3 { margin-top: 2em; margin-bottom: 0.8em; }
        .prose-custom p, .prose-custom ul, .prose-custom ol { line-height: 1.7; }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .bg-white { background-color: #FFFFFF; }
        .border, .border-t { border-color: #e5e7eb; }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                <div class="text-2xl font-bold text-sienna-800">
                    <a href="roadmap.html">OOP Foundations</a>
                </div>
                <nav class="hidden md:flex space-x-4">
                    <a href="day_1.html" class="text-gray-600 hover:text-teal-600 transition">Day 1</a>
                    <a href="day_2.html" class="text-gray-600 hover:text-teal-600 transition">Day 2</a>
                    <a href="day_3.html" class="text-gray-600 hover:text-teal-600 transition">Day 3</a>
                    <a href="day_4.html" class="text-gray-600 hover:text-teal-600 transition">Day 4</a>
                    <a href="day_5.html" class="text-gray-600 hover:text-teal-600 transition">Day 5</a>
                    <a href="day_6.html" class="text-gray-600 hover:text-teal-600 transition">Day 6</a>
                    <a href="day_7.html" class="font-bold text-teal-600">Day 7</a>
                </nav>
                <!-- Return to Homepage button removed from here -->
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 pt-24">
        <div class="flex justify-between items-center mb-12">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-sienna-800">Day 7: Static Classes & Records</h1>
                <p class="mt-4 text-xl text-gray-600">An interactive guide to the architect's toolkit for utility and data patterns in C#.</p>
            </div>
            <a href="roadmap.html" class="btn btn-primary whitespace-nowrap">Return to Homepage</a>
        </div>

        <div class="flex flex-col lg:flex-row-reverse lg:space-x-reverse lg:space-x-12">
            <aside class="w-full lg:w-1/4 lg:sticky lg:top-24 self-start mb-12 lg:mb-0">
                <div class="p-4 rounded-lg bg-white shadow-sm border">
                    <h3 class="text-lg font-semibold mb-4">On This Page</h3>
                    <nav id="toc-nav" class="flex flex-col space-y-2">
                        <a href="#section1" class="toc-link pl-2 text-gray-600">1. Static Classes</a>
                        <a href="#section2" class="toc-link pl-2 text-gray-600">2. C# Records</a>
                        <a href="#section3" class="toc-link pl-2 text-gray-600">3. Advanced Topics</a>
                        <a href="#section4" class="toc-link pl-2 text-gray-600">4. Coding Practice</a>
                        <a href="#section5" class="toc-link pl-2 text-gray-600">5. UML Modeling</a>
                        <a href="#section6" class="toc-link pl-2 text-gray-600">6. Case Study</a>
                        <a href="#section7" class="toc-link pl-2 text-gray-600">7. Knowledge Assessment</a>
                    </nav>
                </div>
            </aside>

            <div class="w-full lg:w-3/4 prose-custom">
                 <section id="section1" class="section-target mb-16">
                        <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 1: The Utility Pattern — Static Classes in .NET</h3>
                        <p>In the landscape of object-oriented programming, the primary unit of organization is the class, a blueprint for creating objects that encapsulate both state (data) and behavior (methods). However, a common design challenge arises: where should one place functionality that is inherently stateless and does not logically belong to any specific object instance? Consider fundamental operations like calculating the absolute value of a number or checking if a file exists on disk. These are pure actions, not entities with identities. Forcing such functions into an instantiable class can feel artificial and lead to cumbersome code, requiring developers to create an object for the sole purpose of calling a single method.</p>
                        <p>This is the problem space that static classes in C# are designed to solve. They represent a pragmatic "compromise between pure object-oriented design and simplicity," serving as a dedicated, organized container for methods and data that are global to an application's scope.</p>
                        
                        <h4 class="mt-8">1.1. Motivation: Why Do We Need Classes We Can't Instantiate?</h4>
                        <p>The motivation for static classes stems from the need to group related, stateless utility functions. The .NET Framework itself provides a canonical example with the <code>System.Math</code> class. It contains a collection of mathematical operations (<code>Sqrt</code>, <code>Max</code>, <code>Sin</code>, etc.) that operate purely on their input parameters without needing to store or retrieve any internal instance data. It would be illogical and inefficient to require a developer to write <code>Math myMath = new Math(); double root = myMath.Sqrt(25);</code>. Instead, the static design allows for the direct, intuitive call: <code>double root = Math.Sqrt(25);</code>.</p>
                        
                        <div class="mt-6 p-4 bg-indigo-50 border-l-4 border-indigo-400 rounded-r-lg">
                            <p class="font-semibold text-indigo-800">Analogy: The Public Workshop</p>
                            <p class="text-slate-700 mt-2">Think of a static class as a public workshop, fully equipped with a collection of specialized tools (its static methods). Anyone in the community can walk in and use the drill press, the table saw, or the lathe without needing to build their own personal workshop (<code>new Workshop()</code>). The tools are shared, globally accessible, and their function doesn't depend on who is using them. The workshop itself isn't an object you possess; it's a location you go to for specific, stateless functions.</p>
                        </div>
                        
                        <h4 class="mt-8">1.2. Anatomy of a Static Class: Core Principles & Compiler Guarantees</h4>
                        <ul class="list-disc pl-5 space-y-2">
                            <li><strong>The <code>static</code> Keyword:</strong> The defining characteristic is the <code>static</code> modifier on the class declaration itself: <code>public static class MyUtils {...}</code>.</li>
                            <li><strong>Non-Instantiable:</strong> The compiler strictly prohibits the creation of instances of a static class. Any attempt to use the <code>new</code> operator will result in a compile-time error.</li>
                            <li><strong>Static-Only Members:</strong> All members declared inside a static class—be they fields, properties, methods, or events—must also be declared as <code>static</code>.</li>
                            <li><strong>Implicitly <code>sealed</code> and <code>abstract</code>:</strong> The compiler automatically treats static classes as if they were declared <code>sealed</code>, meaning they cannot be inherited from.</li>
                            <li><strong>The Static Constructor:</strong> A static class can have a single, parameterless static constructor, invoked automatically by the CLR at most once before the first time any static member of the class is accessed.</li>
                        </ul>

                        <div class="code-block mt-6">
                            <pre class="bg-slate-800 text-white p-4 rounded-lg overflow-x-auto"><code class="language-csharp">public static class MathUtils
{
    public static readonly double PI = 3.14159;

    static MathUtils()
    {
        Console.WriteLine("MathUtils initialized.");
    }

    public static int Add(int a, int b)
    {
        return a + b;
    }
}</code></pre>
                        </div>
                        
                        <h4 class="mt-8">1.4. Architectural Crossroads: Static Class vs. Singleton Pattern</h4>
                        <p>The core distinction is this: <strong>static classes are for stateless behavior</strong>, while <strong>singletons are for managing a single instance of a stateful object</strong>. A static class with mutable static fields is often an anti-pattern—a poorly implemented, untestable singleton.</p>
                        <div class="overflow-x-auto mt-4">
                            <table class="min-w-full divide-y divide-slate-200 border border-slate-200 rounded-lg">
                                <thead class="bg-slate-100">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Feature</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Static Class</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Singleton Pattern</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-slate-200">
                                    <tr><td class="px-6 py-4 font-semibold">Core Intent</td><td class="px-6 py-4">Stateless utility functions.</td><td class="px-6 py-4">Ensures one instance of a stateful object.</td></tr>
                                    <tr><td class="px-6 py-4 font-semibold">Inheritance/Interfaces</td><td class="px-6 py-4">Cannot implement interfaces.</td><td class="px-6 py-4">Can implement interfaces.</td></tr>
                                    <tr><td class="px-6 py-4 font-semibold">Testability</td><td class="px-6 py-4">Very difficult to mock.</td><td class="px-6 py-4">Easier to mock via its interface.</td></tr>
                                    <tr><td class="px-6 py-4 font-semibold">Dependency Injection</td><td class="px-6 py-4">Incompatible.</td><td class="px-6 py-4">Compatible.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                    
                    <section id="section2" class="section-target mb-16">
                        <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 2: The Data Pattern — Records in C# 9+</h3>
                        <p>Introduced in C# 9, <strong>records</strong> are a new reference type specifically designed to create types whose primary role is encapsulating data, with three core pillars: concise syntax, value-based equality, and immutability.</p>
                        
                        <h4 class="mt-8">2.2. The Three Pillars of Records</h4>
                        <p><strong>Pillar 1: Concise Syntax (Positional Records)</strong></p>
                        <p>The following line of code instructs the compiler to generate a full-fledged <code>Person</code> type with a constructor, init-only properties, a deconstructor, and overrides for <code>Equals</code>, <code>GetHashCode</code>, and <code>ToString</code>.</p>
                        <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg"><code class="language-csharp">public record Person(string FirstName, string LastName);</code></pre>
                        </div>
                        
                        <p class="mt-6"><strong>Pillar 2: Value-Based Equality</strong></p>
                        <p>Unlike classes (which use reference equality), two record instances are considered equal if they are of the same type and all their public properties have the same values.</p>
                        <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg"><code class="language-csharp">var person1 = new Person("John", "Doe");
var person2 = new Person("John", "Doe");
Console.WriteLine(person1 == person2); // Output: True</code></pre>
                        </div>

                        <p class="mt-6"><strong>Pillar 3: Immutability by Default</strong></p>
                        <p>Properties generated from positional parameters use an <code>init</code> accessor, meaning they can only be assigned a value during object construction. This makes objects inherently more thread-safe and predictable.</p>
                        
                        <h4 class="mt-8">2.3. Non-Destructive Mutation: The Power of the <code>with</code> Expression</h4>
                        <p>To work with immutable data, the <code>with</code> expression creates a new record instance that is a shallow copy of an existing one, but with specified properties changed. The original record remains untouched.</p>
                        <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg"><code class="language-csharp">var originalUser = new User("Bob", "Reader");
var updatedUser = originalUser with { Name = "Robert" };
Console.WriteLine(originalUser.Name);   // Output: Bob
Console.WriteLine(updatedUser.Name);    // Output: Robert</code></pre>
                        </div>
                    </section>

                    <section id="section3" class="section-target mb-16">
                         <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 3: Advanced Topics & Hazard Analysis</h3>
                         <p>While static classes are invaluable for creating utilities, their misuse, particularly regarding state management, introduces some of the most severe and difficult-to-diagnose bugs in software development. The global, shared nature of static members makes them a magnet for concurrency issues in multithreaded applications.</p>
                         
                         <h4 class="mt-8">3.1. The Perils of Shared State: Why Static Fields Are a Concurrency Magnet</h4>
                         <p>A <code>static</code> field creates a single variable shared across <em>all threads</em>. When multiple threads attempt to read and modify this shared data concurrently without proper synchronization, race conditions can occur, leading to data corruption.</p>
                         <div class="code-block mt-4">
                             <pre class="bg-slate-800 text-white p-4 rounded-lg"><code class="language-csharp">public static class WebMetrics
{
    public static int TotalRequests = 0;
}
// In a web controller:
public void HandleRequest()
{
    WebMetrics.TotalRequests++; // DANGER: This is not thread-safe!
}</code></pre>
                         </div>
                         <div class="mt-6 p-4 bg-amber-50 border-l-4 border-amber-400 rounded-r-lg">
                            <p class="font-semibold text-amber-800">Analogy: The Public Whiteboard</p>
                            <p class="text-slate-700 mt-2">A static field is like a single public whiteboard in a busy office. If two employees (threads) try to update the "Total Sales" number at the exact same time, one update can be lost. One employee reads 100, the other reads 100. Both add their sale and write 101 back. A sale has been lost. Without a strict "one at a time" rule (a lock), the whiteboard's data becomes unreliable.</p>
                        </div>
                        <h4 class="mt-8">3.2. Deep Dive: Race Conditions and Solutions</h4>
                        <p>The operation <code>TotalRequests++</code> is not atomic. It involves a read, a modify, and a write step. To prevent race conditions, these operations must be made atomic using synchronization mechanisms.</p>
                        <ul class="list-disc pl-5 space-y-2 mt-4">
                            <li><strong>The <code>lock</code> Statement:</strong> Ensures that only one thread can enter a block of code at a time, providing mutual exclusion. It's a robust but potentially performance-intensive solution.</li>
                            <li><strong>The <code>Interlocked</code> Class:</strong> Provides highly efficient, lock-free atomic operations for simple arithmetic (e.g., <code>Interlocked.Increment(ref TotalRequests)</code>). It's significantly faster than <code>lock</code> for these specific scenarios.</li>
                        </ul>
                    </section>

                    <section id="section4" class="section-target mb-16">
                        <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 4: Coding Practice — From Theory to Implementation</h3>
                        
                        <h4 class="mt-8">4.1. Foundational: Implementing the <code>MathUtils</code> Static Class</h4>
                         <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg overflow-x-auto"><code class="language-csharp">public static class MathUtils
{
    public static long Factorial(int n)
    {
        if (n < 0) throw new ArgumentOutOfRangeException(nameof(n));
        if (n == 0) return 1;
        long result = 1;
        for (int i = 1; i <= n; i++) result *= i;
        return result;
    }

    public static bool IsPrime(int number)
    {
        if (number <= 1) return false;
        if (number == 2) return true;
        if (number % 2 == 0) return false;
        var boundary = (int)Math.Floor(Math.Sqrt(number));
        for (int i = 3; i <= boundary; i += 2)
            if (number % i == 0) return false;
        return true;
    }
}</code></pre>
                        </div>

                        <h4 class="mt-8">4.2. [Easy] Solution: Crafting a <code>Reverse()</code> String Extension Method</h4>
                         <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg overflow-x-auto"><code class="language-csharp">public static class StringExtensions
{
    public static string Reverse(this string input)
    {
        if (string.IsNullOrEmpty(input)) return input;
        char[] charArray = input.ToCharArray();
        Array.Reverse(charArray);
        return new string(charArray);
    }
}</code></pre>
                        </div>
                    </section>

                    <section id="section5" class="section-target mb-16">
                        <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 5: System Modeling with UML</h3>
                        <p>In UML, static members (attributes and methods) are denoted by <strong>underlining</strong> their names. A static class itself can be marked with the <strong><code>&lt;&lt;utility&gt;&gt;</code></strong> stereotype.</p>
                        
                        <div class="mt-6 p-4 border border-slate-300 rounded-lg bg-white shadow-sm">
                            <p class="text-center font-mono text-sm text-slate-500 mb-2">UML Diagram: Static Helper Classes</p>
                            <div class="flex flex-col md:flex-row gap-6 justify-center">
                                <div class="border border-slate-400 bg-slate-50 p-3 rounded">
                                    <p class="text-center font-semibold">&lt;&lt;utility&gt;&gt;</p>
                                    <p class="text-center font-bold text-lg">MathUtils</p>
                                    <hr class="my-2 border-slate-400">
                                    <p class="font-mono text-sm"><span class="uml-underline">+ PI: double</span></p>
                                    <hr class="my-2 border-slate-400">
                                    <p class="font-mono text-sm"><span class="uml-underline">+ Factorial(n: int): long</span></p>
                                    <p class="font-mono text-sm"><span class="uml-underline">+ IsPrime(number: int): bool</span></p>
                                </div>
                                <div class="border border-slate-400 bg-slate-50 p-3 rounded">
                                    <p class="text-center font-semibold">&lt;&lt;utility&gt;&gt;</p>
                                    <p class="text-center font-bold text-lg">DateUtils</p>
                                    <hr class="my-2 border-slate-400">
                                    <hr class="my-2 border-transparent">
                                    <p class="font-mono text-sm"><span class="uml-underline">+ IsLeapYear(year: int): bool</span></p>
                                    <p class="font-mono text-sm"><span class="uml-underline">+ DaysInMonth(year: int, month: int): int</span></p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <section id="section6" class="section-target mb-16">
                        <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 6: Machine Coding — A Payment Processing Service</h3>
                        <p>This case study synthesizes the concepts. We will design a simple payment processing service leveraging each C# feature for its intended purpose: records for immutable data representation, static classes for stateless utility functions, and regular classes for stateful services.</p>
                        <h4 class="mt-8">Architectural Blueprint</h4>
                        <ol class="list-decimal pl-5 space-y-2">
                          <li><strong><code>Transaction</code> Record:</strong> To represent an immutable payment transaction. A transaction is a historical fact and should not be altered.</li>
                          <li><strong><code>CurrencyConverter</code> Static Class:</strong> To provide pure, stateless functions for converting between currencies. This logic requires no instance state.</li>
                          <li><strong><code>PaymentService</code> Class:</strong> A standard, instantiable class to orchestrate the payment process, containing the core business logic.</li>
                        </ol>
                        
                        <h4 class="mt-8">Implementation</h4>
                        <p><strong>Transaction.cs (Record)</strong></p>
                         <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg overflow-x-auto"><code class="language-csharp">public record Transaction(
    string TransactionId,
    decimal Amount,
    string Currency,
    DateTime Timestamp,
    string Status,
    string PaymentGatewayId
);</code></pre>
                        </div>
                        
                        <p class="mt-6"><strong>CurrencyConverter.cs (Static Class)</strong></p>
                        <div class="code-block mt-4">
                           <pre class="bg-slate-800 text-white p-4 rounded-lg overflow-x-auto"><code class="language-csharp">public static class CurrencyConverter
{
    private static readonly Dictionary<string, decimal> _exchangeRatesToUsd = new()
    {
        { "USD", 1.0m }, { "EUR", 1.08m }, { "GBP", 1.25m }
    };

    public static decimal Convert(decimal amount, string from, string to)
    {
        decimal amountInUsd = amount * _exchangeRatesToUsd[from];
        return Math.Round(amountInUsd / _exchangeRatesToUsd[to], 2);
    }
}</code></pre>
                        </div>
                    </section>
                    
                    <section id="section7" class="section-target">
                        <h3 class="text-2xl border-b border-slate-200 pb-2 mb-6">Section 7: Knowledge Assessment</h3>
                        <p>Complete the quiz to check your grasp of the key concepts. Select an answer for each question and then click "Check Answers" to see your score and the correct solutions.</p>
                        
                        <div id="quiz-container" class="mt-8 space-y-8 bg-white p-6 rounded-lg shadow">
                            <!-- Quiz questions will be injected here by JS -->
                        </div>
                        
                        <div class="mt-6 text-center">
                            <button id="check-quiz-btn" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors">Check Answers</button>
                        </div>

                        <div id="quiz-results" class="mt-6 hidden">
                            <h4 id="quiz-score" class="text-2xl font-bold text-center"></h4>
                            <div id="quiz-feedback" class="mt-4 space-y-4"></div>
                        </div>
                    </section>
            </div>
        </div>
    </main>

    <footer class="mt-16 py-8 bg-white border-t">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex justify-center mb-4">
                <a href="roadmap.html" class="btn btn-primary">Return to Homepage</a>
            </div>
            <p class="text-gray-500">&copy; 2025 OOP Foundations. All Rights Reserved.</p>
            <p class="text-sm mt-1 text-gray-500">A self-contained learning module.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Copy-to-Clipboard ---
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const code = btn.parentElement.querySelector('pre code').innerText;
                    navigator.clipboard.writeText(code).then(() => {
                        btn.textContent = 'Copied!';
                        setTimeout(() => btn.textContent = 'Copy', 2000);
                    });
                });
            });

            // --- Active TOC Link ---
            const sections = document.querySelectorAll('main section');
            const tocLinks = document.querySelectorAll('.toc-link');
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        tocLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('href') === `#${entry.target.id}`) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, { rootMargin: '-40% 0px -60% 0px' });
            sections.forEach(section => observer.observe(section));
        });
    </script>
</body>
</html>
